---
title: "计算服务告警"
weight: 6
---



== 1. ALM-IAAS-00001  跨区迁移失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IaaS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块检测到跨区迁移任务失败，会产生此告警。

*影响范围:* 

影响跨区迁移数据。

*可能原因:* 

迁移数据量较大，同步数据时出错。

*处理方法:*

根据 job id 检查备份节点 storage_server.log 日志，根据日志分析处理。

== 2. ALM-IAAS-00002  节点已发生整体迁移，请及时检查受影响资源

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 节点宕机或故障告警
| 不能
|===

*告警描述:* 

因为宕机或其他原因，已对节点上的资源进行了整体的迁移，需要检查可能受到影响的虚拟机或其他资源。

*影响范围:* 

该宕机节点上的虚拟机或其他业务资源。

*可能原因:* 

节点宕机。

*处理方法:*

请访问对应节点的详情页中的"疏散记录"标签页，获取迁移的虚拟机列表，以评估影响到业务范围。

== 3. ALM-IAAS-00003  计算节点空闲内存不足

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检查计算节点的内存剩余量，若低于阈值则会产生告警。内存使用率 >80% 即告警。

*影响范围:* 

无法在当前计算节点安置更多的主机。

*可能原因:*

. 计算节点因安置太多虚拟机导致内存资源使用紧张；
. 服务器内存配置过小
. 因虚机内存采用精简置备方式分配，在使用过程中，使用量逐渐增加导致告警。

*处理方法:*

. 如果 hyper 当前状态为 faulty、recuing、down、deprecated 以外的状态，auto healing 会自动处理。 
. 如果 auto healing 处理后，告警依然持续输出，需要人工处理。（auto healing 失败 top 查询哪个服务占用内存高，进一步排查。）

== 4. ALM-IAAS-00004  可用区状态异常

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 关键服务异常告警
| 能
|===

*告警描述:* 

告警模块每 1 分钟会检测 ws_server 状态，当发现异常时，会产生此告警。

*影响范围:* 

影响对该可用区的操作请求。

*可能原因:* 

该区的 fg_server 状态异常。

*处理方法:*

. 请联系青云实施人员，根据部署文档更新配置信息。

. 登录对应 fg 节点。

. 执行以下命令查看服务状态。
+
[source,shell]
----
supervisorctl status
----

. 执行以下命令查看监听端口是否存在。
+
[source,shell]
----
netstat -lnp
----
+
是，请联系技术支持。
+
否，执行以下命令重启 fg_server 服务。
+
[source,shell]
----
supervisorctl restart fg_server
----

== 5. ALM-IAAS-00005  创建资源失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟会对计算节点的日志进行检测，当发现任务执行失败时，会产生此告警。

*影响范围:* 

创建资源失败，影响客户使用。

*可能原因:* 

需要通过任务日志信息确认问题原因，详见处理方法。

*处理方法:*

. 登录发出告警的计算节点；

. 执行 `grep j-xxxx /pitrix/log/compute_server.log` 通过 ERROR 级别以上的信息确认原因，做进一步处理。

== 6. ALM-IAAS-00006  镜像节点损坏

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟会对计算节点的镜像节点进行检测，当发现镜像节点无法连接时，会产生此告警。

*影响范围:* 

计算节点和镜像节点数据不同步。

*可能原因:* 

. 镜像节点关机。
. 镜像节点网络故障无法连接。

*处理方法:*

. 修复镜像节点并上线。

. 更换其他镜像节点。

== 7. ALM-IAAS-00007  镜像节点间的通信延迟过高

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 能
|===

*告警描述:* 

告警模块每分钟会对计算节点与镜像节点间的网络进行检测，当发现延时较大时，会产生此告警。

*影响范围:* 

影响该计算节点与镜像节点的通讯。

*可能原因:* 

管理服务内存占用过高或者网络延迟过大。

*处理方法:*

如果是计算节点资源压力过大导致，需要迁移部分负载后恢复。

== 8. ALM-IAAS-00008  节点交换空间使用过高

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 内存占用过高告警
| 能
|===

*告警描述:* 

告警模块会检测计算节点交换空间（SWAP），当发现交换空间用量超过阈值时，产生此告警。告警阈值为 80%。

*影响范围:* 

该节点上的服务或虚拟机会产生卡顿。

*可能原因:*

. 内存资源使用紧张。
. 服务器内存配置过小。

*处理方法:*

先检查可释放内存是否大于 SWAP 内存。如是，则释放 SWAP 内存。否则需迁出部分虚拟机或导致内存使用较高的业务然后再释放 SWAP 空间。

== 9. ALM-IAAS-00009  计算节点剩余磁盘空间过低

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检测硬盘使用量，若超过阈值则会产生此告警。

*影响范围:* 

会影响虚机的各种相关任务，如创建、迁移、备份等任务。

*可能原因:* 

负载过高，归档文件未及时删除。

*处理方法:*

. 如果 hyper 当前状态为 faulty、recuing、down、deprecated 以外的状态，auto healing 会自动处理。
. 如果 auto healing 处理后，告警依然持续输出，需要人工处理。（auto healing 失败 top 查询哪个服务占用内存高，进一步排查。）

== 10. ALM-IAAS-00010  NeonSAN IO 延迟

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟会对计算节点进行检测，当发现 check_qbd_delay_ioerror 事件，会产生此告警。

*影响范围:* 

使用 NeonSAN 存储设备的磁盘或虚拟机。

*可能原因:*

. 发送至 NeonSAN 服务器至返回接收的延迟高；
. 可能网络故障；
. 可能由于 NeonSAN 端磁盘性能不足导致。

*处理方法:*

请联系 NeonSAN 相关服务人员进行处理。

== 11. ALM-IAAS-00011  主机文件系统只读

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检测 compute_agent 服务状态，当发现主机文件系统只读时会产生此告警。

*影响范围:*

. 该告警只影响当前虚拟机。
. 当前宿主机上所有虚拟机出现不可用状态。

*可能原因:* 

主机所在 hyper 的存储可能出现问题，代码会自动处理，后续需要手动定位服务器的存储问题。

*处理方法:*

主机文件系统问题，会自动对出现问题的主机执行迁移操作，无需手动处理。

== 12. ALM-IAAS-00012  计算节点处理请求失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

计算节点在处理操作时如果失败，会产生此告警。

*影响范围:* 

对资源的操作会失败。

*可能原因:*

. 资源状态异常；
. 服务异常，具体需要根据日志分析。

*处理方法:*

需根据请求类型和任务 ID，在计算节点中查询对应的日志，根据日志进一步分析。

== 13. ALM-IAAS-00013  计算节点任务执行失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟会对计算节点的服务日志进行检测，当发现任务失败的信息时，会产生此告警。

*影响范围:* 

异步任务执行失败，可能会发现对资源的创建、更新等操作失败。

*可能原因:* 

失败原因可通过告警中的错误码来确定，可能的错误码有：

* 5000: 内部错误，可能有代码异常
* 5100: 系统繁忙
* 5200: 资源不足
* 5300: 服务在更新中
* 5400: 资源依赖错误

*处理方法:*

. 可在打印的错误日志中查看报错的 task id 和 job id（以 j-开头的编号）。 
. 在告警的节点上执行以下命令，检查执行出错的原因。
+
[source,shell]
----
grep j-xxxx /pitrix/log/compute_server.log
----

== 14. ALM-IAAS-00014  安置主机失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

主机安置时计算节点不可用，安置失败。

*影响范围:* 

可能导致主机无法创建。

*可能原因:*

. 计算节点资源不足。
. 计算节点状态不可用。

*处理方法:*

. 可查看告警日志的 cause is 部分获取到详细的错误原因；

. 检查{platform_name_cn}资源使用情况，检查各计算节点资源（CPU、内存等）是否充足；

. 查看计算节点状态是否是活跃中，是否有足够的计算节点用于安置主机；

. 向安置组中添加更多计算节点。

== 15. ALM-IAAS-00015  lxc 文件系统故障

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检测 compute_agent 服务状态，当发现 pitrix 主机文件系统异常时会产生此告警。

*影响范围:* 

影响 hyper 上的资源。

*可能原因:* 

主机所在 hyper 的存储可能出现问题，代码会自动处理，后续需要手动定位服务器的存储问题。

*处理方法:*

主机文件系统问题，会自动对出现问题的主机执行迁移操作，无需手动处理。

== 16. ALM-IAAS-00016  获取存储空间信息失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块会检测计算节点资源池信息，当读取 hyper 资源池信息错误时，会产生此告警。

*影响范围:* 

影响在当前节点上创建主机和接收迁移的主机。

*可能原因:* 

查询不到 container 信息，根据不同存储类型会有不同的原因和处理方法，详见处理方法。

*处理方法:*

. 如果是 repl 模式，检查 zpool 是否正常。登录告警日志节点, 执行 repl-overview; 可以尝试重启 repl serve; 
+
[source,shell]
----
supervisorctl restart repl_server 
----

. 如果是 local/pair 模式，检查系统磁盘的读写权限是正常。登录告警日志所在节点, 通过执行 `df -h/du` 等命令查看磁盘挂载情况, iostat 查看硬盘各项指标, 其中 util 表示 io 利用率，值越高，说明 io 越接近上限。其中 r/s, w/s 对应的是 iops， rKB/s, wkB/s 对应的是吞吐。 await 表示 cpu 等待的时间。 
+
存储性能有问题时，要么 util 高，要么 await 高, 如果 iostat 存在问题, 可能是磁盘故障, 磁盘可通过 fsck 等工具修复。

== 17. ALM-IAAS-00017  计算节点负载过高

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 节点宕机或故障告警
| 不能
|===

*告警描述:* 

告警模块会检测计算节点负载，当发现负载超过阈值时，会产生此告警。

*影响范围:* 

影响该计算节点上虚拟资源的性能。

*可能原因:*

. 计算节点上运行了较多的虚拟机或其他虚拟资源；
. 计算节点的磁盘性能不足导致负载过高；
. 硬件故障；
. 物理机中毒；

*处理方法:*

可尝试将该告警的计算节点上的资源迁移至其他负载低的节点，然后再尝试修复计算节点，比如重启，修复磁盘等。

== 18. ALM-IAAS-00018  节点发生宕机或网络中断

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 节点宕机或故障告警
| 能
|===

*告警描述:* 

对节点的心跳检查失败，节点可能已经宕机或节点的网络连接已经中断。

*影响范围:* 

该节点无法继续提供服务。

*可能原因:*

. 节点宕机；
. 节点的网络断线；
. 节点的时间可能没有同步；
. 节点上的 telegraf 服务运行异常，未返回心跳数据。

*处理方法:*

出现该告警时，可按以下步骤进行故障排查：

. 先确认告警节点是否已经宕机，可通过 ping 或 ssh 方式来检查是否可以连接到对应节点，如已无法连接，则考虑进行节点的重启或检查节点网络是否正常；

. 如果节点可以正常连接，则请检查节点的时间是否未同步，节点时间未同步时会导致监控数据异常，导致监控认为该节点已经宕机；

. 如果节点的时间是同步的，则请检查节点上的 telegraf 服务是否运行正常，可使用以下命令检查 telegraf 是否正常运行：
+
[source,shell]
----
supervisorctl status telegraf
----
+
如 telegraf 处于正在运行状态，则可以再检查 telegraf 的运行日志，查看其中是否有异常：/var/log/telegraf.log。

== 19. ALM-IAAS-00019  安置副本失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IAAS）
| 关键服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检测 repl_server 服务状态，当检测到安置副本失败时会产生此告警。

*影响范围:* 

影响该资源的副本，可能使得该资源缺少副本。

*可能原因:*

. 硬盘空间不足。
. 安置组资源不足。

*处理方法:*

硬盘资源不足，需要扩容硬盘或者在安置组内添加新节点。

== 20. ALM-IAAS-00020  计算节点交换空间使用过高

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 计算服务异常告警
| 能
|===

*告警描述:* 

告警模块会检测节点 swap，当发现 swap 用量超过阈值时，会产生此告警。告警阈值：>80%。

*影响范围:* 

物理机上被交换到 swap 的虚拟机内存访问卡顿。

*可能原因:*

. 内存资源使用紧张。
. 服务器内存配置过小。
. 因虚机内存采用精简置备方式分配，在使用过程中，内存使用量逐渐增加。

*处理方法:*

检查可释放内存是否大于 swap 内存，如不是，则需要迁出部分虚拟机或导致内存使用较高业务。迁出完成后，在 CLI 界面执行 swap-in 命令，系统会自动进行 swap 清理操作。

== 21. ALM-IAAS-00021  安置组资源不足

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

创建资源安置时判断安置组所有 hyper 空闲资源能否安置，如资源不足，会产生此告警。

*影响范围:* 

无法正常创建资源。

*可能原因:* 

安置组物理机资源不够。

*处理方法:*

. 添加更多可用 hyper 到安置组；

. 修改资源规格信息以安置到其他安置组。

== 22. ALM-IAAS-00022  主机实际状态与数据库状态不一致

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检测计算服务状态，当发现主机状态错误时会产生此告警。

*影响范围:* 

影响该主机的状态展示。

*可能原因:* 

一般是迁移过程中出了问题导致，需要具体看迁移的报错。

*处理方法:*

主机状态为关机状态，但是在数据库里是开机的状态。只在计算节点异常时告警，此时需要检查主机是否已经迁移走，并清理主机。

== 23. ALM-IAAS-00023  副本不一致

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IAAS）
| 关键服务异常告警
| 不能
|===

*告警描述:* 

告警模块会检测 zfs 的副本状态，当识别到 zfs 保存的副本与之前数据不一致时，会产生此告警。

*影响范围:* 

影响副本的数据一致性，出现问题恢复时，会有丢失数据的可能。

*可能原因:* 

负载高，同步数据异常，或者 repl server 进程故障。

*处理方法:*

. repl 模式下，当前副本和其他副本不一致。
. 登录告警节点, 尝试用 `repl-unbuild/repl-build`，重新生成副本。

== 24. ALM-IAAS-00024  计算节点 CPU 使用率过高

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 阈值告警
| 提示
| 计算服务（IAAS）
| CPU 负载过高告警
| 能
|===

*告警描述:* 

告警模块会每 1 分钟检查 hyper 上 cpu 使用率，超过阈值则会产生此告警。

*影响范围:* 

影响该计算节点上主机资源的稳定运行。

*可能原因:* 

. 负载高。
. 节点中毒。

*处理方法:*

. 如果是 qemu 造成的 cpu 使用率过高，auto healing 会自动迁移虚机，无需处理。 
. 如果是其他原因造成的 cpu 使用率高，会一直打印告警，这个时候需要人工排查 cpu 使用率高的原因。 
. 检查{platform_name_cn} server.yaml： 
+
[source,shell]
----
compute_server: 
 max_vbr_jobs: 20 
 hyperpair_rescue_strict_mode: 0 
 disbale_hyperpair_rescue: 0 
 auto_healing: 
  load_high_threshold: 0 
  memory_low_threshold: 5 
  space_low_threshold: 5 
enable_auto_healing
----

== 25. ALM-IAAS-00025  多副本数据不一致

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 计算服务（IAAS）
| 计算服务异常告警
| 不能
|===

*告警描述:* 

告警模块会检测 zfs 的副本状态，当识别到 zfs 保存的副本与之前数据不一致时，会产生此告警。

*影响范围:* 

影响副本的数据一致性，出现问题恢复时，会有丢失数据的可能。

*可能原因:* 

负载高，同步数据异常，或者 repl server 进程故障。

*处理方法:*

. repl 模式下，当前副本和其他副本不一致。
. 登录告警节点, 尝试用 `repl-unbuild/repl-build`，重新生成副本。