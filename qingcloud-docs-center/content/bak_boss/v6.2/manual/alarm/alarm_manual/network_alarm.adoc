---
title: "网络服务告警"
weight: 12
---


== 1. ALM-SDN-00001  主机网络繁忙

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块每 1 分钟检测 compute_monitor 服务状态，当发现主机外出流量 pps 过高时会产生此告警。（到底是检查 compute_monitor 还是 cpmpute_agent 服务）。

*影响范围:* 

只影响该主机。

*可能原因:* 

主机外出 PPS 有突发。

*处理方法:*

查看主机监控，cpu 内存网络流量是否有突发，超过 pps_tx_alert 配置。

确认流量是否正常。否，不需处理，是，根据用户需要调整 pps。

== 2. ALM-SDN-00002  BGP 私有网络节点离开失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟会对计算节点的日志进行检测，当发现 bgp 网络离开失败时，会产生此告警。

*影响范围:* 

该私有网络收敛异常。

*可能原因:* 

bgp 相关网络命令执行失败，具体需要通过日志进行确认。

*处理方法:*

. 登录到告警的计算节点。

. 通过 vxnet id 过滤 compute_server.log 日志文件，确认失败原因，做进一步处理。

== 3. ALM-SDN-00003  负载均衡器状态异常

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 关键服务异常告警
| 不能
|===

*告警描述:* 

告警模块每 1 分钟检测 LB 服务状态，当检测到 LB node 故障时会产生此告警。

*影响范围:* 

暂无影响。

*可能原因:* 

. 网络异常。
. lb 节点故障。

*处理方法:*

vg 到 lb 健康检查失败，可能是短时间网络不通。无网络问题可忽略。

== 4. ALM-SDN-00004  没有足够的 IPv6 地址分配给用户

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 不能
|===

*告警描述:* 

没有足够的 IPv6 地址分配给用户。

*影响范围:* 

不能分配 IPv6 地址。

*可能原因:* 

ipv6 地址池耗尽或者没有注册 ipv6 地址池。

*处理方法:*

释放一部分 IPV6 网段或者增加更多的 IPV6 网段，通过 register-ipv6-networks 注册 ipv6 地址，即向 vpc_ipv6_network_pool 表中注册 ipv6 网络地址（BOSS 上注册 IPV6 地址）。

== 5. ALM-SDN-00005  EIP 入流量超限

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 阈值告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块会对 EIP 的吞吐数据进行监控，当检查到 EIP pps 过高时（默认阈值为 400000），可能被攻击，会产生此告警。

*影响范围:* 

当前 EIP 可能无法使用。

*可能原因:* 

EIP 流量过大、或者被攻击。

*处理方法:*

首先需要判断是常规业务流量还是攻击流量，如果属于攻击流量，

. 建议增加 ddos 攻击防护能力；
. 如果业务层没办法购买攻击防护，只能建议更换 ip 地址。

如果属于常规业务流量，

. 提升带宽的大小，并调整告警阀值。

== 6. ALM-SDN-00006  EIP 网关连接不可达

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块会检查网关信息，当 x86-vg 检测到上联 eip 网关网络异常时，会产生此告警。

*影响范围:* 

相关资源网络中断。

*可能原因:* 

物理网络环境异常。

*处理方法:*

x86-vg 检测到上联 eip 网关网络异常。需要检查 vg 到上联的网络。

. 检查上联交换机是否有故障。
. 检查 vg 网卡是否故障。
. 检查网线是否损坏。


== 7. ALM-SDN-00007  dhcpd 服务启动失败

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 网络服务（SDN）
| 关键服务异常告警
| 能
|===

*告警描述:* 

告警模块每 1 分钟会对计算节点 compute_server 的 dvr_dhcpd 服务进行检测，当发现服务异常时，会产生此告警。

*影响范围:* 

会影响到私有网络下部分或者所有主机均无法正常获取到 ip 地址。

*可能原因:* 

. 计算节点的 compute_server 服务繁忙。
. 计算节点的负载比较高。
. 计算节点内核版本比较低，比如内核在 4.4 及以下的版本触发概率会比较高。

*处理方法:*

. 在 boss 查询 vxnet id，在详情界面找到分布式路由器，可以找到 *Master*（控制节点）。

. 登录到 *Master*（控制节点）所在的 hyper，检查一下 rtr-9upeluqx_dhcpd 服务是否正常，如果异常的情况比如退出，可以尝试以下办法：

.. 启动 rtr-9upeluqx_dhcpd 服务，采用以下命令：
+
[source,shell]
----
initctl start rtr-9upeluqx_dhcpd  # 物理机操作系统版本低的 os

systemctl start rtr-9upeluqx_dhcpd # 物理机操作系统版本高的 os
----
.. 如以上方法无法启动，则需要检查一下当前私有网络是否存在主机无法获取 ip 的情况，如存在记录主机 id 及对应物理节点的 id，如当前私有网络为 vxnet-xkewjnw，vm 所在计算节点为 qa1ar01n03，可以按照以下方法操作:
+
登录到 ws 节点，运行命令，把 dhcp server 迁到跟主机相同的节点，可以最大程度解决问题。
+
[source,shell]
----
/pitrix/cli#./migrate-vxnets -t qa1ar01n03 -v vxnet-xkewjnw
----
+

include::../../../../../_components/note.adoc[]

dhcp server 指的是 dvr controller 节点。

include::../../../../../_components/table_footer.adoc[]

== 8. ALM-SDN-00008  EIP 可用量不足

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块会对 EIP 资源池进行监控，当 EIP 池没有足够 EIP 可用时，会产生此告警。

*影响范围:* 

无法申请 EIP。

*可能原因:* 

EIP 可用数不足。

*处理方法:*

. 登录云计算运维管理平台；
. 若有必要，在资源管理 > 网络 > IP 组界面中新建 IP 组，用于新 EIP 分组；
. 在资源管理 > 网络 > EIP 池界面中创建新的 EIP 地址段，或给已有的 EIP 组进行扩容。

== 9. ALM-SDN-00009  基础网络的 rsnode 节点与 route_server bgp 连接异常，请检查

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 重要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块会检查各个基础网络的多个 rs_node 节点与所有 ks rsserver 节点的 bgp 连接状态，当 bgp 连接异常时告警。

*影响范围:* 

环境一般最少有 4 个 ks rsserver 节点，且每个基础网络最少有 2 个 rs_node 节点，只有单个基础网络的所有 rs_node 与所有的 rsserver 同时断连时才会影响基础网络的业务流量。

*可能原因:* 

rsserver 节点故障或者 rs_node 故障。

*处理方法:*

. 当多个基础网络的 rs_node 同时与相同的 rsserver 节点 bgp 断连时，排查该 rsserver 节点状态，可以重启该 rsserver 节点的 gobgpd 服务。
. 当基础网络的某个 rs_node 与多个 rsserver bgp 断连时，可以迁移该 rs_node 节点。

== 10. ALM-SDN-00010  虚拟网关可能宕机

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 不能
|===

*告警描述:* 

对虚拟网关（vg）节点进行周期性检查，发现 vg 节点故障，则会产生此告警。

*影响范围:* 

如果有其他 vg，eip 会自动迁移，eip 可能会有短暂中断。

如果没有其他 vg，eip 对应业务会中断。

*可能原因:* 

vg 宕机或 vg 网络异常。

*处理方法:*

zone_leader 检查 vg，发现 vg 异常，需要对 vg 进行检查。

== 11. ALM-SDN-00011  EIP 入流量超限

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 不能
|===

*告警描述:* 

告警模块会对 EIP 的吞吐数据进行监控，当检查到 EIP bps 过高时，可能被攻击，会产生此告警。

*影响范围:* 

当前 EIP 可能无法使用。

*可能原因:* 

. EIP 流量过大。
. EIP 被攻击.

*处理方法:*

需要检查是否影响业务：

. 如果影响业务则需要客户确定是否需要更换 eip。
. 如果不影响业务，并且确认当前都是正常业务流量，是需要确认是否需要提高 eip 带宽或告警阈值 eip_maximum_bw （Mbps）。

== 12. ALM-SDN-00012  EIP 流量（pps）过高

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 阈值告警
| 紧急
| 网络服务（SDN）
| 网络服务异常告警
| 不能
|===

*告警描述:* 

告警模块会检测 eip 流量，检测到 eip 流量过高时，自动对 eip 进行迁移，同时产生此告警。

*影响范围:* 

可能影响同一 VG 上其他 EIP 性能。

*可能原因:* 

业务流量过大或受到攻击，导致 EIP 流量过大。

*处理方法:*

x86-vg 上的某个 eip 流量超过阈值，会根据配置决定是否自动迁移。需要检查流量是否正常。

== 13. ALM-SDN-00013  DNS 节点网络不可达

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块会检测 DNS 节点状态，当 DNS 节点网络不可达时，会产生此告警。

*影响范围:* 

导致域名无法解析。

*可能原因:* 

DNS 节点网络原因导致不可访问，或者 DNS 节点宕机。

*处理方法:*

. 确认报错的 DNS 节点虚拟机是不是宕机；

. 如果宕机需要重新启动虚拟机，如果没有宕机则说明网络不通；

. 查看网络为何不通，可以从尝试节点系统内部 ping 其他 DNS 节点；

. 节点之间是否有安全组策略拦截，或者其他网络网络配置配置问题。

== 14. ALM-SDN-00014  EIP 带宽超限

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 阈值告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 不能
|===

*告警描述:* 

EIP 带宽超过阀值。

*影响范围:* 

访问相关业务可能会出现网络延迟。

*可能原因:* 

业务高峰期出现带宽不足、文件传输、系统中毒（挖矿程序）。

*处理方法:*

根据业务实际情况,可以考虑升级带宽或添加节点来解决带宽不足问题。

== 15. ALM-SDN-00015  BGP 连接异常

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 紧急
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块每 1 分钟会对 BGP 的状态进行检测，当发现 BGP 状态异常时，会产生此告警。

*影响范围:* 

单个 bm bgp 问题不影响路由收敛，所有 bm 节点 bgp 都有问题会影响 vpc border 功能。

*可能原因:*

. peer 端状态异常。
. 到对应的 peer 端网络异常。
. 本端或对端配置异常。

*处理方法:*

. 使用 `gobgp n` 获取 peer 状态信息，确认状态异常的 peer 信息。

. 通过 ping 确认本端到对端的网络情况，如果无法 ping 通，登录到对端 peer 节点检查状态。

. 如果对端运行正常，检查两端的配置文件 `/etc/gobgpd.conf`，排查 Peer 段内容是否有问题。

== 16. ALM-SDN-00016  主机出站流量超限

[cols="5*", options="header"]
|===
| 告警类型 | 告警等级 | 告警来源 | 告警分类 | 能否自愈

| 事件告警
| 次要
| 网络服务（SDN）
| 网络服务异常告警
| 能
|===

*告警描述:* 

告警模块每 1 分钟检测 compute_monitor 服务状态，当发现主机外出流量带宽过高时会产生此告警。

*影响范围:* 

可能影响{platform_name_cn}网络吞吐。

*可能原因:*

. 业务量突然增加；
. 主机中毒。

*处理方法:*

需登录虚拟机，结合 CPU 占用等，检查流量突然增加的原因。