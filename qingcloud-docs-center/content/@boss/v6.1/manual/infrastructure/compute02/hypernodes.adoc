---
title: "计算节点"
weight: 10
---
 

== 场景描述

计算节点是平台用于分配虚拟主机等资源的节点，包含 CPU、内存和硬盘的物理计算资源，一个计算节点需占用超融合机箱设备的一个节点，一个计算节点上可运行多个虚拟主机。这个模块可以对负责计算的物理节点进行监控，列表支持监控和普通列表两种视图。

== 功能描述

计算节点页面展示了{platform_name_cn}上所有计算节点列表，包括计算节点的标记状态、节点 ID/IP、节点类型、CPU 架构、当前状态、安置组、云服务器数、镜像节点等列表信息和 CPU 使用率、VCPU 使用率、物理内存使用率、虚拟内存使用率、硬盘寿命、物理硬盘使用率、虚拟硬盘使用率、CPU SI、CPU WA 以及 Container Utils 等监控信息。

include::../../../../../_components/note.adoc[]
CPU SI：SI 指的是 software irq，表示软件中断 CPU 消耗时间，软中断是由软件的指令方式触发的。

CPU WA：WA 指的是 iowait，表示等待输入输出的 CPU 时间百分比，如果 wa 特别高，那么一般说明是磁盘 IO 出现问题，可以使用 iostat 等命令继续进行详细分析。

include::../../../../../_components/table_footer.adoc[]

== 前提条件

已获取 BOSS 的登录账号和密码。

== 操作步骤

. 使用浏览器登录 BOSS。
. 选择 *基础设施* > *计算* > *计算节点*，进入 *计算节点* 页面。
+
image::/images/boss/manual/infrastructure/hypernodes_operation.png[]

. 点击计算节点 ID/IP，进入计算节点详情页面。
+
在  *监控* 页签，分为资源监控和配置/使用率两个模块，*资源监控* 下可查看指定时间段内 CPU 使用率监控、内存使用率监控、交换分区使用率监控、磁盘使用率监控、磁盘吞吐量监控以及磁盘 IOPS 监控数据；*配置/使用率* 展示了云服务器运行数量和 CPU、内存以及硬盘的使用情况占比。
+
在 *网络监控* 页签，可查看指定时间段内的物理网卡流量监控和节点 DVR 流量监控，并可查看节点网卡流量排名和节点 DVR 网卡流量排名列表详情。
+
在 *云服务器* 页签，可查看该节点下所有的云服务器的详情信息，点击云服务器名称可进入云服务器的详情页面。点击 *监控* 可查看该计算节点上正在运行的云服务器的 CPU、内存以及硬盘使用率数据。
+
在 *硬盘* 页签，可查看该计算节点下所有的硬盘列表信息，点击硬盘名称，可进入硬盘详情页面。
+
在 *BGP 规则* 页签，可查看该计算节点下所设置的所有 BGP 规则列表信息。
+
在 *任务* 页签，可查看在该节点上各个用户执行的所有操作任务列表信息和记录。
+
在 *服务进程* 页签，可查看该节点所有服务进程列表，并展示服务进程的状态、名称、进程 ID、服务角色以及持续运行时间等信息。
+
在 *告警记录* 页签，可查看该节点上所产生的告警列表及详情，点击概要信息，可进入告警详情页面。
+
在 *日志* 页签，可查看该节点上的日志分类和详细日志信息。
+
在 *疏散记录* 页签，可查看该计算节点上所有虚拟机迁移的记录列表，点击疏散记录名称，可查看疏散记录详情。

=== 标记计算节点状态

. 在计算节点页面，在计算节点所在行末尾点击image:/images/boss/manual/icon.png[]，点击 *标记状态*。
. 根据提示勾选需要标记的状态，输入操作原因。
. 点击 *标记*。

=== 设置安置组

include::../../../../../_components/note.adoc[]
{platform_name_cn}安置组用于根据硬件类型划分资源调度策略，根据不同类型的资源调度请求下发到不同安置组的计算节点，管理员可以根据实际资源池划分需求，配置相应的安置组规则，不同安置组之间不会触发自动迁移。

include::../../../../../_components/table_footer.adoc[]

. 在计算节点页面，在计算节点所在行末尾点击image:/images/boss/manual/icon.png[]，点击 *设置安置组*。
. 勾选一个或多个安置组，输入操作原因。
. 点击 *设置*。

=== 修改计算节点信息

. 在计算节点页面，在计算节点所在行末尾点击image:/images/boss/manual/icon.png[]，点击 *修改信息*。
. 输入名称、备注、最大 CPU（核数）、最打内存（MB）以及操作原因。
. 点击 *修改*。

=== 使用在线命令查询信息

. 在计算节点页面，在计算节点所在行末尾点击image:/images/boss/manual/icon.png[]，点击 *在线命令*。
. 根据查询内容点击 *选择命令*。
+
具体命令了参见<<_命令参考>>。

. 根据提示输入参数，点击 *执行*。

==== 命令参考

[cols="3,4,3", options="header"]
|===
|命令
|显示命令
|描述

|agent-cat-dns
|safe-guest-sh \{instance} 'cat /etc/resolv.conf'
|查看虚拟机中的 DNS 服务器信息

|agent-cat-fstab
|safe-guest-sh \{instance} '`cat /etc/fstab`'
|查看虚拟机中的挂载配置

|agent-cat-haproxy-cfg
|safe-guest-sh \{instance} 'cat /etc/haproxy/haproxy.cfg'
|查看虚拟机中的 haproxy 配置

|agent-df
|safe-guest-sh \{instance} '`df -h`'
|查看虚拟机磁盘使用情况

|agent-dmesg
|safe-guest-sh \{instance} 'dmesg \| tail -n \{number}'
|查看虚拟机系统的内核日志

|agent-fdisk
|safe-guest-sh \{instance} 'fdisk -l'
|查看虚拟机磁盘分区

|agent-free
|safe-guest-sh \{instance} '`free -m`'
|查看虚拟机的内存使用情况

|agent-ifconfig
|safe-guest-sh \{instance} 'ifconfig'
|查看虚拟机网卡信息

|agent-iostat
|safe-guest-sh \{instance} 'iostat -x 1 \{batch_count}`'
|查看虚拟机中的 IO 活动统计

|agent-iotop
|safe-guest-sh \{instance} 'iotop -b -d 1 -n \{batch_count} \| head -n \{head_n}`'
|查看虚拟机中的 IO 活动情况(iotop)

|agent-ip-a
|safe-guest-sh \{instance} 'ip a'
|查看虚拟机中的 ip 信息

|agent-ip-n
|safe-guest-sh \{instance} 'ip neighbour'
|查看虚拟机中的 ARP 信息

|agent-ip-r
|safe-guest-sh \{instance} 'ip r'
|查看虚拟机路由信息

|agengt-iptables-S
|safe-guest-sh \{instance} 'iptables -S'
|查看虚拟机中的防火墙信息(iptables)

|agengt-iptables-nat-S
|safe-guest-sh \{instance} 'iptables -t nat -S'
|查看虚拟机中的 NAT 规则

|agengt-kill-centos-setup-prosess
|safe-guest-sh \{instance} 'pkill -9 -f setup'
|终止 centos 的设置进程

|agent-mount-l
|safe-guest-sh \{instance} 'mount -l'
|查看虚拟机中的磁盘挂在情况

|agent-netstat-a
|safe-guest-sh \{instance} 'netstat -anp'
|查看虚拟机中网络连接情况

|agengt-netstat-l
|safe-guest-sh \{instance} 'netstat -lnp'
|查看虚拟机中网络监听情况

|agengt-ping
|safe-guest-sh \{instance} 'ping -c \{batch_count} \{ip_or_host}' \{batch_count}
|在虚拟机中运行 ping 测试

|agengt-ps-grep
|safe-guest-sh \{instance} 'ps -ef \| grep -i \{keyword}'
|查看虚拟机中的进程信息

|agent-sysctl-grep
|safe-guest-sh \{instance} 'sysctl -a \| grep -i \{keyword}'
|查看虚拟机系统的内核参数

|agent-top
|safe-guest-sh \{instance} 'COLUMNS=999 top -c -b -d 1 -n \{batch_count} \| head -n \{head_n}'
|查看虚拟机中的资源活动前情况

|agengt-ulimit-a
|safe-guest-sh \{instance} 'ulimit -a'
|查看虚拟机系统的资源限制(ulimit)

|agent-uptime
|safe-guest-sh \{instance} 'uptime'
|查看虚拟机的开机运行时长

|cat_file
|cat \{file}
|查看文件内容

|df
|df -h
|查看磁盘使用量

|dmesg
|dmesg
|查看内核日志

|drbd-overview
|drbd-overview
|drbd overview

|free
|free -m
|查看内存使用情况(free)

|head_and_grep
|head -n \{large_number} \{file} \| grep \{keyword}
|查看指定文件头部的内容，支持 grep

|head_file
|head -n \{number} \{file}
|查看指定文件同步的内容

|ifconfig
|ifconfig \{nic}
|查看网卡信息

|iostat
|iostat -x 1 \{batch_count}
|查看 io 活动统计

|iotop
|iotop -b -d 1 -n \{batch_count} \| head -n \{head_n}
|查看 io 活动情况(iotop)

|ip-a
|ip a
|查看 ip 地址

|ip-r
|ip r
|查看路由信息

|ipset-list
|ipset list \{keyword} \| head -n \{number}
|查看 IP 地址集合

|iptables-S
|iptables -S \| grep \{keyword}
|获取所有防火墙规则

|iptables-mangle-S
|iptables -t mangle -S \| grep \{keyword}
|获取所有策略路由

|iptables-nat-S
|iptables -t nat -S \| grep \{keyword}
|获取所有 NAT 规则

|list_files
|ls -lh \{path}
|列文件(ls)

|mpstat
|COLUMNS=999 mpstat -P ALL -u 1 \{batch_count}
|mpstat

|net-flow
|/pitrix/bin/net-flow -k \{key} -L \{limit} -c \{batch_count} -t \{type}
|查看流量

|ns-ip-a
|ip netns exec \{netns} ip a
|获取指定 network namespace 中的 ip 地址

|ns-ip-r
|ip netns exec \{netns} ip r
|获取指定 network namespace 中的路由信息

|ns-iptables-S
|ip netns exec \{netns} iptables -S
|获取指定 network namespace 中的防火墙规则

|ns-iptables-nat-S
|ip netns exec \{netns} iptables -t nat -S
|获取指定 network namespace 中的 NAT 规则

|ns-ping
|ip netns exec \{netns} ping -c \{batch_count} \{ip_or_host}
|在指定 network namespace 中执行 ping 命令

|ps-cpu
|ps -Ao user,uid,args,pid,pcpu,psr,pmem,tty,etimes,cputime --sort=-pcpu \| head -n \{head_n}
|ps ordered by cpu

|repl_overview
|repl-overview -v
|repl overview

|supervisorctl_status
|supervisorctl status
|查看服务状态(supervisor)

|tail_and_grep
|tail -n \{large_number} \{file} \| grep \{keyword}
|查看指定文件尾部内容，支持 grep

|tail_file
|tail -n \{number} \{file}
|查看指定文件尾部的内容(tail)

|top
|COLUMNS=999 top -c -b -d 1 -n \{batch_count} \| head -n \{head_n}
|获取系统资源活动情况

|top-pid
|COLUMNS=999 top -p \{pid} -c -b -d 1 -n \{batch_count} \| head -n \{head_n}
|top by pid in batch mode

|zpool_list
|zpool list
|查看 ZFS 存储池信息(zpool)

|zpool_status
|zpool status
|查看 ZFS 存储池状态(zpool)
|===

=== 屏蔽告警

. 在计算节点页面，在计算节点所在行末尾点击image:/images/boss/manual/icon.png[]，点击 *屏蔽告警*。
. 重新输入节点 ID、选择压制时长，输入操作原因。
. 点击 *创建*。
