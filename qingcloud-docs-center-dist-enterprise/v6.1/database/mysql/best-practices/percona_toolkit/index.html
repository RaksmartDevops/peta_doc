




<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<meta name="keywords" content="[数据库,MySQL PLus,关系型数据库,MySQL,慢日志分析]">



<meta name="description" content="本小节主要介绍如何通过 percona-toolkit 工具进行 MySQL 慢日志分析。">

<link rel="icon" href="https://console.petaexpress.com/assets/cdn/hinata/0a234310-78f9-4323-8d59-2b36ac15120a-favicon.ico" type="image/x-icon">

<title>使用 percona-toolkit 工具分析 MySQL 慢日志 - 用户指南</title>
<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/bulma-tooltip.min.css" rel="stylesheet">
<link href="/css/atom-one-light.css" rel="stylesheet" />
<link href="/css/magnific-popup.css" rel="stylesheet" />


<link href="/scss/main.min.e407fb236ca21333e8c63516ab2f144dd2cdbdaf2eca08e58895ff89ce74abc3.css" rel="stylesheet" integrity="sha256-5Af7I2yiEzPoxjUWqy8UTdLNva8uygjliJX/ic50q8M=">

<script src="/js/jquery-2.2.4.js"></script>
<body
        class="root   "
        style=""
        ><header>
  <nav class="navbar">
    
      <a href="/" class="navbar-logo-wrapper">
        <img class="navbar-logo" src="https://console.petaexpress.com/assets/cdn/hinata/ba65c1e6-b7a4-4085-b0e2-23104d8e71e1-logo_en.svg" />
        <div class="navbar-split navbar-left-split">|</div>
        <div class="navbar-logo-text">企业云</div>
      </a>
    
    <div class="navbar-nav">
      <div
        class="navbar-nav-item navbar-nav-version "
        style="display:none;">
        
        <div class="dropdown-trigger">
          <span class="project-version">
            v6.1
          </span>
          
        </div>
        
      </div>
      
    </div>
    <div class="search navbar-search">
      <form action="/v6.1/search/" method="GET">
        <div class="control has-icons-left has-icons-right docs-search-input">
          <span class="icon is-left">
            <img src="/images/icons/magnifier_duotone.svg" />
          </span>
          <input
            class="input"
            name="q"
            type="input"
            placeholder="请输入关键字快速获取帮助"
            autocomplete="off"
          />
          <span class="icon is-right"> </span>
        </div>
        <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
      </form>
      <div class="search-result navbar-search-result">
        <div class="search-result-loading"></div>
        <div class="search-result-content"></div>
        <div class="search-result-none">
          没有找到搜索结果， 请更换关键词重新搜索
        </div>
      </div>
    </div>
    
      
      
        
          <a class="navbar-item-right btn primary-btn navbar-btn "
            target="_blank"
            data-url="https://console.petaexpress.com"
            data-text="控制台"
            href="https://console.petaexpress.com">
            控制台
          </a>
        
      
    
  </nav>
</header><script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>

<script id="search-result-item-template" type="text/x-js-template">
  <div class="search-result-content-item">
    <div class="search-result-content-item-title">
      <a href="${href}">${title}</a>
    </div>
    <div class="search-result-content-item-content">
      ${content}
    </div>
    <div class="search-result-content-item-ref">
      <ul class="content-breadcrumb">
      </ul>
    </div>
  </div>
</div>
</script>

<script id="search-breadcrumb-template" type="text/x-js-template">
  <li class="icon-slash_fill">
    <a href="${href}">${title}</a>
  </li>
</script>

<script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>
<script id="search-result-page-template" type="text/x-js-template">
  <nav class="search-result-pagination pagination is-centered">
    <a class="pagination-previous icon-chevron_left_fill"></a>
    <a class="pagination-next icon-chevron_right_fill"></a>
    <ul class="pagination-list">
    </ul>
  </nav>
</script>
<div class="container">

  


  
    
  


<aside class="sidebar-wrapper">
  <div class="sidebar-drag"></div>
  <div class="sidebar">
    
      <div class="sidebar-title" >
        <a href="/v6.1/database/mysql/">
          
            关系型数据库 MySQL Plus
        </a>
        
          <span class="icon-menu_fill"></span>
        
      </div>
      
        <div class="search-sidebar-wrapper">
          
<div class="search search-sidebar">
  <div class="control has-icons-left has-icons-right docs-search-input">
    <span class="icon is-left">
      <img src="/images/icons/magnifier_duotone.svg" />
    </span>
    <input class="input" name="q" type="input" placeholder="请输入关键字快速获取帮助" autocomplete="off" />
    <span class="icon is-right"> </span>
  </div>
  <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
</div>
<div class="search-sidebar-result columns">
  
    <div class="column">
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-computing_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">计算</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/compute/vm/">
      云服务器
    </a>
    
    <a href="/v6.1/compute/hpc/">
      弹性高性能计算 EHPC
    </a>
    
    <a href="/v6.1/compute/image/">
      镜像
    </a>
    
    <a href="/v6.1/compute/ssh/">
      SSH 密钥
    </a>
    
    <a href="/v6.1/compute/instance_group/">
      安置策略组
    </a>
    
    <a href="/v6.1/compute/migration/">
      跨区域迁移
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-database_cache_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据库</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/database/mysql/">
      关系型数据库 MySQL Plus
    </a>
    
    <a href="/v6.1/database/postgresql/">
      关系型数据库 PostgreSQL
    </a>
    
    <a href="/v6.1/database/radondb/">
      分布式数据库 RadonDB
    </a>
    
    <a href="/v6.1/database/polondb/">
      分布式数据库 PolonDB
    </a>
    
    <a href="/v6.1/database/chronusdb/">
      时序数据库 ChronusDB
    </a>
    
    <a href="/v6.1/database/mongodb/">
      文档数据库 MongoDB
    </a>
    
    <a href="/v6.1/database/mongodb_cluster/">
      文档数据库 MongoDB Cluster
    </a>
    
    <a href="/v6.1/database/redis_standalone/">
      键值数据库 Redis Standalone
    </a>
    
    <a href="/v6.1/database/redis_cluster/">
      键值数据库 Redis Cluster
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-container_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">容器</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/container/qke_plus/">
      容器引擎 QKE
    </a>
    
    <a href="/v6.1/container/harbor/">
      Harbor 镜像仓库
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-operation_manage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">运维与管理</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/operation/migration/">
      服务器迁移中心
    </a>
    
    <a href="/v6.1/operation/topology/">
      资源编排
    </a>
    
    <a href="/v6.1/operation/resource/">
      资源管理
    </a>
    
    <a href="/v6.1/operation/autoscaling/">
      自动伸缩
    </a>
    
    <a href="/v6.1/operation/tools/">
      运维工具
    </a>
    
    <a href="/v6.1/operation/vmware/">
      VMware 纳管
    </a>
    
  </div>
</div>
        
      
        
      
    </div>
    <div class="column">
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-storage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">存储</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/storage/disk/">
      硬盘
    </a>
    
    <a href="/v6.1/storage/backup/">
      备份
    </a>
    
    <a href="/v6.1/storage/object_storage/">
      对象存储
    </a>
    
    <a href="/v6.1/storage/epfs/">
      文件存储 EPFS
    </a>
    
    <a href="/v6.1/storage/vnas/">
      文件存储 vNAS
    </a>
    
    <a href="/v6.1/storage/qfs/">
      文件存储 QFS
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-mq_middleware_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">消息队列与中间件</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/middware/kafka/">
      Kafka 服务
    </a>
    
    <a href="/v6.1/middware/rabbitmq/">
      RabbitMQ 服务
    </a>
    
    <a href="/v6.1/middware/etcd/">
      Etcd 服务
    </a>
    
    <a href="/v6.1/middware/api_gateway/">
      API 网关
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-shield_key_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">安全</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/security/firewall/">
      云防火墙 CFW
    </a>
    
    <a href="/v6.1/security/srp/">
      安全资源池
    </a>
    
    <a href="/v6.1/security/hss/">
      主机安全
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-data_warehouse_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">用户服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/services/bill_center/">
      费用中心
    </a>
    
    <a href="/v6.1/services/notification-center/">
      消息中心
    </a>
    
    <a href="/v6.1/services/vdc/">
      企业管理
    </a>
    
  </div>
</div>
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-nat_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">网络服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/network/vpc/">
      VPC 网络
    </a>
    
    <a href="/v6.1/network/nat_gateway/">
      NAT 网关
    </a>
    
    <a href="/v6.1/network/eip/">
      弹性公网 EIP
    </a>
    
    <a href="/v6.1/network/loadbalancer/">
      负载均衡
    </a>
    
    <a href="/v6.1/network/border_router/">
      边界路由器
    </a>
    
    <a href="/v6.1/network/security_group/">
      安全组
    </a>
    
    <a href="/v6.1/network/acl/">
      网络访问控制
    </a>
    
    <a href="/v6.1/network/mcn/">
      流量牵引服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bigdata_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">大数据服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/bigdata/elk/">
      ELK 服务
    </a>
    
    <a href="/v6.1/bigdata/opensearch/">
      OpenSearch 服务
    </a>
    
    <a href="/v6.1/bigdata/zookeeper/">
      ZooKeeper 服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-monitor_service_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">监控服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/monitor_service/cloudsat/">
      云监控 CloudSat
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-apps_5_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">AppCenter</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/appcenter/market/">
      AppCenter 控制台
    </a>
    
    <a href="/v6.1/appcenter/dev-platform/">
      应用开发平台
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bi_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据仓库与 BI</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/dwh_bi/clickhouse/">
      ClickHouse
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-human_gear_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">访问与鉴权</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/authorization/iam/">
      访问鉴权管理
    </a>
    
    <a href="/v6.1/authorization/account/">
      账户中心
    </a>
    
    <a href="/v6.1/authorization/access_key/">
      API 密钥
    </a>
    
  </div>
</div>
      
      
      
      
      
      
    </div>
  
</div>
        </div>
      
    
    <nav class="sidebar-menu">
      
        
        <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >产品简介</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/intro/introduction/">什么是 MySQL Plus</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/intro/function/">功能特性</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/intro/list/">产品系列</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/intro/version/">产品版本</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/intro/superiority/">产品优势</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >计费指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/billing/price/">计费说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/billing/change_price/">费用变更</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/billing/charge/">到期与欠费</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/billing/refund/">退款说明</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >快速入门</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/quickstart/create_cluster/">步骤一：创建集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/quickstart/create_account/">步骤二：创建数据库账号</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/quickstart/access_mysqlplus/">步骤三：连接数据库</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >操作指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >数据迁移</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/migration/migration_online_mysqldump/">在线迁移: mysqldump 方式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/migration/migration_online_xtrabackup/">在线迁移: xtrabackup 方式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/migration/data_transfer/">离线迁移</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/migration/exchange_reservedip/">交换预留 IP</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >数据库连接</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_connect/access_mysqlplus/">连接数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_connect/enable_external_network/">开启外网访问</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_connect/mgt_external_network/">管理外网地址</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_connect/mgt_whitelist/">管理 IP 白名单</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_connect/mgt_vxnet/">切换私有网络</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_connect/exchange_reservedip/">交换预留 IP</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >集群生命周期</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/cluster_info/">集群概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/check_cluster/">查看集群信息</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/upgrade/">版本升级</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/off_and_on/">启停集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/switch_billing_mode/">修改计费模式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/renew_manual/">续费</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/unsubscribe/">退订</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/delete_cluster/">删除集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/cluster_lifecycle/recycle_bin/">回收站</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >节点生命周期</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/node_info/">节点概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/capacity_expansion/">扩容节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/create_node/">新增节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/delete_node/">删除节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/restart_node/">重启节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/rebuild_node/">重建节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/switch_role/">切换主节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/node_lifecycle/read_only_node/">开关主节点只读</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/ssl_trans_encryption/">SSL 传输加密</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >异地灾备</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/disaste_recovery/disaster_recovery/">启动异地灾备</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/disaste_recovery/switch_to_dr/">切换业务至灾备集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/disaste_recovery/data_move_back/">回迁业务至源集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/disaste_recovery/disable_dr/">停止灾备</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >账号管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_account/creat_account/">添加账号</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_account/create_multi_accounts/">批量添加集群账号</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_account/delete_account/">删除账号</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_account/mgt_analysis_instance/">分析实例账号</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >配置参数</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/config_para/config_para_info/">参数介绍</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/config_para/modify_para/">修改配置参数</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >备份与恢复</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/backup_info/">备份概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/manual_backup/">创建手动备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/auto_backup/">设置自动备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/logical_backup_storage/">设置存储策略</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/check_backup/">查看备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/restore_point_in_time/">恢复集群到指定时间</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/restore_from_backup/">从备份恢复集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/replicate_backup/">跨区域复制备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/share_backup/">共享备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/backup_restoration/delete_backup/">删除备份</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >日志管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_log/log_info/">日志概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_log/enable_log_service/">启动日志服务</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_log/download_log/">预览和下载日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/mgt_log/disable_log_service/">关闭日志服务</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >监控与告警</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/metrics_alarm/config_display_metrics/">监控指标</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/metrics_alarm/set_alarm_rules/">设置监控告警</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/metrics_alarm/view_monitor_metrics/">查看资源和服务监控</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/metrics_alarm/zabbix_client_service/">Zabbix 客户端服务 </a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/manual/metrics_alarm/zabbix_server/">配置 Zabbix 监控</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a >最佳实践</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/best-practices/download_mysql_log/">下载 MySQL 日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/best-practices/clean_binlog/">清理 MySQL binlog 日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item active current">
            <a href="/v6.1/database/mysql/best-practices/percona_toolkit/">使用 percona-toolkit 工具分析 MySQL 慢日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/best-practices/benchmark_test/">基准测试</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >常见问题</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/question/">产品咨询</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/performance/">数据库性能</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/access/">数据库连接</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/account/">用户帐号</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/monitor/">监控</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/migration/">数据管理</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/expansion/">扩容和升级</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/configpara/">配置参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/faq/log/">日志管理</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >故障排查</a>
            
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mysql/trouble/access_problems/">无法连接数据库</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
      
    </nav>

  </div>
</aside>
<div class="content-card-wrapper">
  <div class="content-card">
    <div class="content-wrapper"><ul class="content-breadcrumb">
      <li class="icon-slash_fill"><a href="/v6.1" data-url="/v6.1">用户指南</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/database/mysql" data-url="/v6.1/database/mysql">关系型数据库 MySQL Plus</a></li>
        
        <li class="icon-slash_fill"><a href="/v6.1/database/mysql/best-practices/download_mysql_log/" data-url="/v6.1/database/mysql/best-practices">最佳实践</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/database/mysql/best-practices/percona_toolkit" data-url="/v6.1/database/mysql/best-practices/percona_toolkit">使用 percona-toolkit 工具分析 MySQL 慢日志</a></li></ul><div class="post-wrapper"><div class="post">
  <h1 class="post-title">
    使用 percona-toolkit 工具分析 MySQL 慢日志</h1>
  <div class="post-info">
    <div class="post-date">
      更新时间：2024-03-07 19:06:53
    </div>
    
    
    
    
    
    
    
      <div
        class="tag post-tag export-pdf has-tooltip-top has-tooltip-arrow"
        data-tooltip="下载范围：所属一级目录的全部内容"
        data-url="/v6.1/database/mysql/best-practices">
        <span class="icon-format_pdf_2_fill"></span>
        PDF
      </div>
      
    
  </div><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_获取_percona_toolkit_工具路径">获取 percona-toolkit 工具路径</a></li>
    <li><a href="#_获取慢日志路径">获取慢日志路径</a></li>
    <li><a href="#_分析慢日志">分析慢日志</a></li>
    <li><a href="#_分析结果示例">分析结果示例</a></li>
    <li><a href="#_分析结果说明">分析结果说明</a></li>
  </ul>
</nav>
</div><div class="post-content">
    
      
      
<div class="paragraph">
<p>默认总耗时时长超过 3s 的语句会被记录到慢日志中。时长可通过参数 Long_query_time 进行调整，参数详细介绍及修改参数的步骤请参见<a href="../../manual/config_para/config_para_info">参数介绍</a>和<a href="../../manual/config_para/modify_para">修改配置参数</a>。</p>
</div>
<div class="paragraph">
<p>本小节主要介绍如何通过 percona-toolkit 工具进行 MySQL 慢日志分析。</p>
</div>
<div class="sect1">
<h2 id="_获取_percona_toolkit_工具路径">获取 percona-toolkit 工具路径</h2>
<div class="sectionbody">
<div class="paragraph">
<p>percona-toolkit 工具在主实例/只读实例节点所在主机上。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>工具集路径：/home/ubuntu/percona-toolkit/bin/</p>
</li>
<li>
<p>慢日志统计工具路径：/home/ubuntu/percona-toolkit/bin/pt-query-digest</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_获取慢日志路径">获取慢日志路径</h2>
<div class="sectionbody">
<div class="paragraph">
<p>日志保存在主实例/只读实例节点所在主机上。</p>
</div>
<div class="paragraph">
<p>慢日志保存路径：/data/mysql-log/mysql-slow/mysql-slow.log</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_分析慢日志">分析慢日志</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>登录主实例/只读实例节点所在主机。</p>
</li>
<li>
<p>执行以下命令，分析 mysql-slow.log 中的相关慢日志，并输出分析结果（本文以输出到文本文件 A.txt 为例）。</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">/home/ubuntu/percona-toolkit/bin/pt-query-digest /data/mysql-log/mysql-slow/mysql-slow.log &gt; /data/A.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>参数说明</strong>：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/home/ubuntu/percona-toolkit/bin/pt-query-digest</strong>：慢日志统计工具路径。</p>
</li>
<li>
<p><strong>/data/mysql-log/mysql-slow/mysql-slow.log</strong>：慢日志保存路径。</p>
</li>
<li>
<p><strong>A.txt</strong>：分析结果的文本文件名称，可以自定义。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_分析结果示例">分析结果示例</h2>
<div class="sectionbody">
<div class="paragraph">
<p>打开 A.txt 文件，即可看到慢日志分析结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># 200ms user time, 10ms system time, 29.74M rss, 36.67M vsz
# Current date: Thu Dec 29 15:49:04 2022
# Hostname: i-6emrs19i
# Files: /data/mysql-log/mysql-slow/mysql-slow.log
# Overall: 8 total, 2 unique, 0.00 QPS, 0.03x concurrency ________________
# Time range: 2022-12-29T14:16:26 to 2022-12-29T15:38:52
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           158s      3s     51s     20s     49s     15s     20s
# Lock time            2ms   148us     1ms   306us     1ms   276us   224us
# Rows sent              0       0       0       0       0       0       0
# Rows examine      33.50M   1.00M   8.00M   4.19M   7.65M   2.54M   4.93M
# Rows affecte      20.75M 512.00k   8.00M   2.59M   7.65M   2.22M   2.42M
# Bytes sent           446      14      62   55.75   59.77   15.19   59.77
# Query size           407      22      55   50.88   54.21   10.83   54.21

# Profile
# Rank Query ID                           Response time  Calls R/Call  V/M
# ==== ================================== ============== ===== ======= ===
#    1 0x1F32B88358F38D34F85C6FAE9E2CE01A 106.5287 67.5%     7 15.2184  7.13 INSERT SELECT apple_test
#    2 0xCED5D8C62622BEA1DE7AD589E9A48AA9  51.2485 32.5%     1 51.2485  0.00 DELETE apple_test

# Query 1: 0.00 QPS, 0.02x concurrency, ID 0x1F32B88358F38D34F85C6FAE9E2CE01A at byte 3850
# This item is included in the report because it matches --limit.
# Scores: V/M = 7.13
# Time range: 2022-12-29T14:16:26 to 2022-12-29T15:38:52
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         87       7
# Exec time     67    107s      3s     36s     15s     35s     10s     11s
# Lock time     57     1ms   148us   315us   202us   301us    52us   159us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  76  25.50M   1.00M   8.00M   3.64M   7.65M   2.29M   2.88M
# Rows affecte  61  12.75M 512.00k   4.00M   1.82M   3.86M   1.14M   1.46M
# Bytes sent    96     432      61      62   61.71   59.77       0   59.77
# Query size    94     385      55      55      55      55       0      55
# String:
# Databases    testdb
# Hosts        localhost
# Last errno   0
# Users        root
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s  ################################################
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `testdb` LIKE &#39;apple_test&#39;\G
#    SHOW CREATE TABLE `testdb`.`apple_test`\G
insert into apple_test(a, b) select a,b from apple_test\G

# Query 2: 0 QPS, 0x concurrency, ID 0xCED5D8C62622BEA1DE7AD589E9A48AA9 at byte 4190
# This item is included in the report because it matches --limit.
# Scores: V/M = 0.00
# Time range: all events occurred at 2022-12-29T15:28:18
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         12       1
# Exec time     32     51s     51s     51s     51s     51s       0     51s
# Lock time     42     1ms     1ms     1ms     1ms     1ms       0     1ms
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine  23   8.00M   8.00M   8.00M   8.00M   8.00M       0   8.00M
# Rows affecte  38   8.00M   8.00M   8.00M   8.00M   8.00M       0   8.00M
# Bytes sent     3      14      14      14      14      14       0      14
# Query size     5      22      22      22      22      22       0      22
# String:
# Databases    testdb
# Hosts        localhost
# Last errno   0
# Users        root
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms
#  10ms
# 100ms
#    1s
#  10s+  ################################################################
# Tables
#    SHOW TABLE STATUS FROM `testdb` LIKE &#39;apple_test&#39;\G
#    SHOW CREATE TABLE `testdb`.`apple_test`\G
delete from apple_test\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select * from  apple_test\G</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_分析结果说明">分析结果说明</h2>
<div class="sectionbody">
<div class="paragraph">
<p>结果示例中有两类耗时较长的语句，如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>insert into apple_test(a, b) select a,b from apple_test;
delete from apple_test;</pre>
</div>
</div>
<div class="paragraph">
<p>可将结果分为三部分：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>第一部分：总体概要信息</p>
<div class="listingblock">
<div class="content">
<pre>   # 200ms user time, 10ms system time, 29.74M rss, 36.67M vsz
   # Current date: Thu Dec 29 15:49:04 2022
   # Hostname: i-6emrs19i
   # Files: /data/mysql-log/mysql-slow/mysql-slow.log
   # Overall: 8 total, 2 unique, 0.00 QPS, 0.03x concurrency ________________
   # Time range: 2022-12-29T14:16:26 to 2022-12-29T15:38:52
   # Attribute          total     min     max     avg     95%  stddev  median
   # ============     ======= ======= ======= ======= ======= ======= =======
   # Exec time           158s      3s     51s     20s     49s     15s     20s
   # Lock time            2ms   148us     1ms   306us     1ms   276us   224us
   # Rows sent              0       0       0       0       0       0       0
   # Rows examine      33.50M   1.00M   8.00M   4.19M   7.65M   2.54M   4.93M
   # Rows affecte      20.75M 512.00k   8.00M   2.59M   7.65M   2.22M   2.42M
   # Bytes sent           446      14      62   55.75   59.77   15.19   59.77
   # Query size           407      22      55   50.88   54.21   10.83   54.21</pre>
</div>
</div>
<div class="paragraph">
<p>参数说明如下：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 75%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分析结果生成的时间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">主机名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分析的文件所在路径。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overall</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>分析的 SQL 数量统计。<br/>
本示例中总共存在的慢 SQL 有 8 条，实际上分为两类，insert 和 delete。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>total 为总语句数量。</p>
</li>
<li>
<p>unique 为唯一查询数量，即对查询条件进行参数化以后，统计的总共有多少个不同的查询。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">本次分析中所以慢 SQL 所在的时间段。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exec time</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SQL 执行时间。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>total 总时间。</p>
</li>
<li>
<p>min 最短时间。</p>
</li>
<li>
<p>max 最长时间。</p>
</li>
<li>
<p>avg 平均时间。</p>
</li>
<li>
<p>95% 把所有耗时从小到大排列，位置最接近 95% 的那个数。</p>
</li>
<li>
<p>stddev 标准偏差。</p>
</li>
<li>
<p>median 中位数。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lock time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">锁占用的时间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Row sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送到客户端的行数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Row examine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL 语句扫描行数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bytes sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">发送到客户端的字节数。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询的字符数。</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>第二部分：SQL 概要信息</p>
<div class="listingblock">
<div class="content">
<pre>   # Profile
   # Rank Query ID                           Response time  Calls R/Call  V/M
   # ==== ================================== ============== ===== ======= ===
   #    1 0x1F32B88358F38D34F85C6FAE9E2CE01A 106.5287 67.5%     7 15.2184  7.13 INSERT SELECT apple_test
   #    2 0xCED5D8C62622BEA1DE7AD589E9A48AA9  51.2485 32.5%     1 51.2485  0.00 DELETE apple_test</pre>
</div>
</div>
<div class="paragraph">
<p>参数说明如下：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 75%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL 在此次统计中的耗时排名。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pt-query-digest 为此类 SQL 生成的唯一 ID，可以通过此 ID 找到本 SQL 对应的详细信息。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">此类 SQL 总耗时时间。全部 Query 加起来就是所有慢 SQL 的总耗时时间。<br/>
百分比数值是该类 SQL 耗时占此次统计慢 SQL 总耗时时间的百分比。全部 Query 加起来就是 100%。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">执行次数，即本次分析总共有多少条这种类型的 SQL 语句。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/Call</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">平均每次执行的响应时间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V/M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应时间的方差与平均比。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">大致的 SQL 语句，体现 SQL 的类型。</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>第三部分：SQL 详细信息</p>
<div class="listingblock">
<div class="content">
<pre>   # Query 1: 0.00 QPS, 0.02x concurrency, ID 0x1F32B88358F38D34F85C6FAE9E2CE01A at byte 3850
   # This item is included in the report because it matches --limit.
   # Scores: V/M = 7.13
   # Time range: 2022-12-29T14:16:26 to 2022-12-29T15:38:52
   # Attribute    pct   total     min     max     avg     95%  stddev  median
   # ============ === ======= ======= ======= ======= ======= ======= =======
   # Count         87       7
   # Exec time     67    107s      3s     36s     15s     35s     10s     11s
   # Lock time     57     1ms   148us   315us   202us   301us    52us   159us
   # Rows sent      0       0       0       0       0       0       0       0
   # Rows examine  76  25.50M   1.00M   8.00M   3.64M   7.65M   2.29M   2.88M
   # Rows affecte  61  12.75M 512.00k   4.00M   1.82M   3.86M   1.14M   1.46M
   # Bytes sent    96     432      61      62   61.71   59.77       0   59.77
   # Query size    94     385      55      55      55      55       0      55
   # String:
   # Databases    testdb
   # Hosts        localhost
   # Last errno   0
   # Users        root
   # Query_time distribution
   #   1us
   #  10us
   # 100us
   #   1ms
   #  10ms
   # 100ms
   #    1s  ################################################
   #  10s+  ################################################################
   # Tables
   #    SHOW TABLE STATUS FROM `testdb` LIKE &#39;apple_test&#39;\G
   #    SHOW CREATE TABLE `testdb`.`apple_test`\G
   insert into apple_test(a, b) select a,b from apple_test\G

   # Query 2: 0 QPS, 0x concurrency, ID 0xCED5D8C62622BEA1DE7AD589E9A48AA9 at byte 4190
   # This item is included in the report because it matches --limit.
   # Scores: V/M = 0.00
   # Time range: all events occurred at 2022-12-29T15:28:18
   # Attribute    pct   total     min     max     avg     95%  stddev  median
   # ============ === ======= ======= ======= ======= ======= ======= =======
   # Count         12       1
   # Exec time     32     51s     51s     51s     51s     51s       0     51s
   # Lock time     42     1ms     1ms     1ms     1ms     1ms       0     1ms
   # Rows sent      0       0       0       0       0       0       0       0
   # Rows examine  23   8.00M   8.00M   8.00M   8.00M   8.00M       0   8.00M
   # Rows affecte  38   8.00M   8.00M   8.00M   8.00M   8.00M       0   8.00M
   # Bytes sent     3      14      14      14      14      14       0      14
   # Query size     5      22      22      22      22      22       0      22
   # String:
   # Databases    testdb
   # Hosts        localhost
   # Last errno   0
   # Users        root
   # Query_time distribution
   #   1us
   #  10us
   # 100us
   #   1ms
   #  10ms
   # 100ms
   #    1s
   #  10s+  ################################################################
   # Tables
   #    SHOW TABLE STATUS FROM `testdb` LIKE &#39;apple_test&#39;\G
   #    SHOW CREATE TABLE `testdb`.`apple_test`\G
   delete from apple_test\G
   # Converted for EXPLAIN
   # EXPLAIN /*!50100 PARTITIONS*/
   select * from  apple_test\G</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Query 1、Query 2 是此次分析结果中出现的两类慢 SQL。</p>
</li>
<li>
<p>参数说明：</p>
<div class="paragraph">
<p>列表参数可以参考第一部分，其他参数说明如下：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 75%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Databases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL 执行的数据库。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL 执行的用户。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query_time distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">查询时长的分布，此次统计中的两个 SQL 语句执行时间都在秒级和十秒级。</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>如下表示如果用户想优化在慢日志中看到的 SQL 语句，可能需要检查表的状态以及表结构，这些就是相关的 SQL 语句。</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">SHOW TABLE STATUS FROM `testdb` LIKE &#39;apple_test&#39;\G
SHOW CREATE TABLE `testdb`.`apple_test`\G</code></pre>
</div>
</div>
</li>
<li>
<p><code>delete from apple_test\G</code> 是此类慢 SQL 语句的示例。</p>
</li>
<li>
<p>如下是 SQL 语句的相关执行计划，但是对于非 select 语句通常不能再次执行来查看执行计划，因此 pt-query-digest 会尝试将 SQL 转化为等效的 select 语句然后展示出来。</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">Converted for EXPLAIN
EXPLAIN /*!50100 PARTITIONS*/
select * from  apple_test\G</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>

    

  </div>
  <div class="post-footer">
    <div class="post-prev">
    </div>
    <div class="post-next">
    </div>
  </div>
  <div class="post-back-to-top">
    <span class="icon-up_3_fill"></span>
  </div>
</div>
<div class="post-placeholder"><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_获取_percona_toolkit_工具路径">获取 percona-toolkit 工具路径</a></li>
    <li><a href="#_获取慢日志路径">获取慢日志路径</a></li>
    <li><a href="#_分析慢日志">分析慢日志</a></li>
    <li><a href="#_分析结果示例">分析结果示例</a></li>
    <li><a href="#_分析结果说明">分析结果说明</a></li>
  </ul>
</nav>
</div></div>
      </div>
    </div>
  </div>
</div></div>
    </body><script src="/js/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/search/jquery.mark.min.js"></script>

<script type="text/javascript" src="/js/common.428b8a7f426567136e0501d49705f10dac2e4539d10c2f396d7c9ee45df1469eaa38e983928589e0e35ed30c1732ddbcda694ac0928ffffffee76b4a0017adf2.js" integrity="sha512-QouKf0JlZxNuBQHUlwXxDawuRTnRDC85bXye5F3xRp6qOOmDkoWJ4ONe0wwXMt282mlKwJKP///&#43;52tKABet8g=="></script>

<script type="text/javascript" src="/js/search.d8001c3e1b66b9a0b48e0c23ad0dbfc0906f194f8925ae78a9900b960679cfa7e41cebd9efd654f84535d02cbce7c4971f226e6f07288c26c3c4560c36d7655b.js"></script>
<script>
  $(function() {
    
    hljs.highlightAll();
    
    $.each($('.post-content .imageblock img'), function () {
      $(this).attr('data-mfp-src', $(this).attr('src'));
    });
    $('.post-content').magnificPopup({
      disableOn: function () {
        if ($(window).width() < 600) {
          return false;
        }
        return true;
      },
      delegate: '.imageblock img',
      type: 'image',
      gallery: {
        enabled: true,
      },
    });
  });
</script>
</html>
