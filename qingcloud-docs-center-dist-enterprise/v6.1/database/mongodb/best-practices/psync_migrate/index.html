




<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<meta name="keywords" content="[MongoDB，数据库，MongoShake]">



<meta name="description" content="介绍如何使用 RedisShake 实现 Redis 跨集群异步复制">

<link rel="icon" href="https://console.petaexpress.com/assets/cdn/hinata/0a234310-78f9-4323-8d59-2b36ac15120a-favicon.ico" type="image/x-icon">

<title>利用 MongoShake 实现 MongoDB 跨集群异步复制 - 用户指南</title>
<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/bulma-tooltip.min.css" rel="stylesheet">
<link href="/css/atom-one-light.css" rel="stylesheet" />
<link href="/css/magnific-popup.css" rel="stylesheet" />


<link href="/scss/main.min.e407fb236ca21333e8c63516ab2f144dd2cdbdaf2eca08e58895ff89ce74abc3.css" rel="stylesheet" integrity="sha256-5Af7I2yiEzPoxjUWqy8UTdLNva8uygjliJX/ic50q8M=">

<script src="/js/jquery-2.2.4.js"></script>
<body
        class="root   "
        style=""
        ><header>
  <nav class="navbar">
    
      <a href="/" class="navbar-logo-wrapper">
        <img class="navbar-logo" src="https://console.petaexpress.com/assets/cdn/hinata/ba65c1e6-b7a4-4085-b0e2-23104d8e71e1-logo_en.svg" />
        <div class="navbar-split navbar-left-split">|</div>
        <div class="navbar-logo-text">企业云</div>
      </a>
    
    <div class="navbar-nav">
      <div
        class="navbar-nav-item navbar-nav-version "
        style="display:none;">
        
        <div class="dropdown-trigger">
          <span class="project-version">
            v6.1
          </span>
          
        </div>
        
      </div>
      
    </div>
    <div class="search navbar-search">
      <form action="/v6.1/search/" method="GET">
        <div class="control has-icons-left has-icons-right docs-search-input">
          <span class="icon is-left">
            <img src="/images/icons/magnifier_duotone.svg" />
          </span>
          <input
            class="input"
            name="q"
            type="input"
            placeholder="请输入关键字快速获取帮助"
            autocomplete="off"
          />
          <span class="icon is-right"> </span>
        </div>
        <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
      </form>
      <div class="search-result navbar-search-result">
        <div class="search-result-loading"></div>
        <div class="search-result-content"></div>
        <div class="search-result-none">
          没有找到搜索结果， 请更换关键词重新搜索
        </div>
      </div>
    </div>
    
      
      
        
          <a class="navbar-item-right btn primary-btn navbar-btn "
            target="_blank"
            data-url="https://console.petaexpress.com"
            data-text="控制台"
            href="https://console.petaexpress.com">
            控制台
          </a>
        
      
    
  </nav>
</header><script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>

<script id="search-result-item-template" type="text/x-js-template">
  <div class="search-result-content-item">
    <div class="search-result-content-item-title">
      <a href="${href}">${title}</a>
    </div>
    <div class="search-result-content-item-content">
      ${content}
    </div>
    <div class="search-result-content-item-ref">
      <ul class="content-breadcrumb">
      </ul>
    </div>
  </div>
</div>
</script>

<script id="search-breadcrumb-template" type="text/x-js-template">
  <li class="icon-slash_fill">
    <a href="${href}">${title}</a>
  </li>
</script>

<script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>
<script id="search-result-page-template" type="text/x-js-template">
  <nav class="search-result-pagination pagination is-centered">
    <a class="pagination-previous icon-chevron_left_fill"></a>
    <a class="pagination-next icon-chevron_right_fill"></a>
    <ul class="pagination-list">
    </ul>
  </nav>
</script>
<div class="container">

  


  
    
  


<aside class="sidebar-wrapper">
  <div class="sidebar-drag"></div>
  <div class="sidebar">
    
      <div class="sidebar-title" >
        <a href="/v6.1/database/mongodb/">
          
            文档数据库 MongoDB
        </a>
        
          <span class="icon-menu_fill"></span>
        
      </div>
      
        <div class="search-sidebar-wrapper">
          
<div class="search search-sidebar">
  <div class="control has-icons-left has-icons-right docs-search-input">
    <span class="icon is-left">
      <img src="/images/icons/magnifier_duotone.svg" />
    </span>
    <input class="input" name="q" type="input" placeholder="请输入关键字快速获取帮助" autocomplete="off" />
    <span class="icon is-right"> </span>
  </div>
  <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
</div>
<div class="search-sidebar-result columns">
  
    <div class="column">
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-computing_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">计算</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/compute/vm/">
      云服务器
    </a>
    
    <a href="/v6.1/compute/hpc/">
      弹性高性能计算 EHPC
    </a>
    
    <a href="/v6.1/compute/image/">
      镜像
    </a>
    
    <a href="/v6.1/compute/ssh/">
      SSH 密钥
    </a>
    
    <a href="/v6.1/compute/instance_group/">
      安置策略组
    </a>
    
    <a href="/v6.1/compute/migration/">
      跨区域迁移
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-database_cache_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据库</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/database/mysql/">
      关系型数据库 MySQL Plus
    </a>
    
    <a href="/v6.1/database/postgresql/">
      关系型数据库 PostgreSQL
    </a>
    
    <a href="/v6.1/database/radondb/">
      分布式数据库 RadonDB
    </a>
    
    <a href="/v6.1/database/polondb/">
      分布式数据库 PolonDB
    </a>
    
    <a href="/v6.1/database/chronusdb/">
      时序数据库 ChronusDB
    </a>
    
    <a href="/v6.1/database/mongodb/">
      文档数据库 MongoDB
    </a>
    
    <a href="/v6.1/database/mongodb_cluster/">
      文档数据库 MongoDB Cluster
    </a>
    
    <a href="/v6.1/database/redis_standalone/">
      键值数据库 Redis Standalone
    </a>
    
    <a href="/v6.1/database/redis_cluster/">
      键值数据库 Redis Cluster
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-container_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">容器</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/container/qke_plus/">
      容器引擎 QKE
    </a>
    
    <a href="/v6.1/container/harbor/">
      Harbor 镜像仓库
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-operation_manage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">运维与管理</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/operation/migration/">
      服务器迁移中心
    </a>
    
    <a href="/v6.1/operation/topology/">
      资源编排
    </a>
    
    <a href="/v6.1/operation/resource/">
      资源管理
    </a>
    
    <a href="/v6.1/operation/autoscaling/">
      自动伸缩
    </a>
    
    <a href="/v6.1/operation/tools/">
      运维工具
    </a>
    
    <a href="/v6.1/operation/vmware/">
      VMware 纳管
    </a>
    
  </div>
</div>
        
      
        
      
    </div>
    <div class="column">
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-storage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">存储</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/storage/disk/">
      硬盘
    </a>
    
    <a href="/v6.1/storage/backup/">
      备份
    </a>
    
    <a href="/v6.1/storage/object_storage/">
      对象存储
    </a>
    
    <a href="/v6.1/storage/epfs/">
      文件存储 EPFS
    </a>
    
    <a href="/v6.1/storage/vnas/">
      文件存储 vNAS
    </a>
    
    <a href="/v6.1/storage/qfs/">
      文件存储 QFS
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-mq_middleware_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">消息队列与中间件</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/middware/kafka/">
      Kafka 服务
    </a>
    
    <a href="/v6.1/middware/rabbitmq/">
      RabbitMQ 服务
    </a>
    
    <a href="/v6.1/middware/etcd/">
      Etcd 服务
    </a>
    
    <a href="/v6.1/middware/api_gateway/">
      API 网关
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-shield_key_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">安全</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/security/firewall/">
      云防火墙 CFW
    </a>
    
    <a href="/v6.1/security/srp/">
      安全资源池
    </a>
    
    <a href="/v6.1/security/hss/">
      主机安全
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-data_warehouse_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">用户服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/services/bill_center/">
      费用中心
    </a>
    
    <a href="/v6.1/services/notification-center/">
      消息中心
    </a>
    
    <a href="/v6.1/services/vdc/">
      企业管理
    </a>
    
  </div>
</div>
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-nat_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">网络服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/network/vpc/">
      VPC 网络
    </a>
    
    <a href="/v6.1/network/nat_gateway/">
      NAT 网关
    </a>
    
    <a href="/v6.1/network/eip/">
      弹性公网 EIP
    </a>
    
    <a href="/v6.1/network/loadbalancer/">
      负载均衡
    </a>
    
    <a href="/v6.1/network/border_router/">
      边界路由器
    </a>
    
    <a href="/v6.1/network/security_group/">
      安全组
    </a>
    
    <a href="/v6.1/network/acl/">
      网络访问控制
    </a>
    
    <a href="/v6.1/network/mcn/">
      流量牵引服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bigdata_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">大数据服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/bigdata/elk/">
      ELK 服务
    </a>
    
    <a href="/v6.1/bigdata/opensearch/">
      OpenSearch 服务
    </a>
    
    <a href="/v6.1/bigdata/zookeeper/">
      ZooKeeper 服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-monitor_service_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">监控服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/monitor_service/cloudsat/">
      云监控 CloudSat
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-apps_5_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">AppCenter</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/appcenter/market/">
      AppCenter 控制台
    </a>
    
    <a href="/v6.1/appcenter/dev-platform/">
      应用开发平台
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bi_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据仓库与 BI</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/dwh_bi/clickhouse/">
      ClickHouse
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-human_gear_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">访问与鉴权</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/authorization/iam/">
      访问鉴权管理
    </a>
    
    <a href="/v6.1/authorization/account/">
      账户中心
    </a>
    
    <a href="/v6.1/authorization/access_key/">
      API 密钥
    </a>
    
  </div>
</div>
      
      
      
      
      
      
    </div>
  
</div>
        </div>
      
    
    <nav class="sidebar-menu">
      
        
        <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >产品简介</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/introduction/">什么是 MongoDB</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/function/">功能特性</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/specification/">实例规格</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/scenarios/">应用场景</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/superiority/">产品优势</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/version/">版本介绍</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/intro/basic_content/">基本概念</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >计费指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/billing/price/">计费说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/billing/change_price/">费用变更</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/billing/charge/">到期与欠费</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/billing/refund/">退款说明</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >快速入门</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/quickstart/create_cluster/">创建集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/quickstart/access_mongodb/">访问数据库</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >操作指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >数据迁移</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/migration/mongo_shake/">MongoShake 方式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/migration/mongo_dump_restore/">mongodump 与 mongorestore 方式</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >数据库连接</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/mgt_connect/access_mongodb/">连接数据库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/mgt_connect/mgt_vxnet/">切换私有网络</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >集群生命周期</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/cluster_info/">集群概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/check_cluster/">查看集群信息</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/upgrade/">版本升级与降级</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/off_and_on/">启停集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/switch_billing_mode/">修改计费模式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/switch_node_mode/">更改服务器类型</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/renew_manual/">续费</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/unsubscribe/">退订</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/delete_cluster/">删除集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/cluster_lifecycle/recycle_bin/">回收站</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >节点生命周期</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/node_lifecycle/node_info/">节点概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/node_lifecycle/capacity_expansion/">扩容节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/node_lifecycle/create_node/">新增节点</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/node_lifecycle/delete_node/">删除节点</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/create_user/">创建用户</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >配置参数</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/config_para/config_para_info/">参数介绍</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/config_para/modify_para/">修改配置参数</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >备份与恢复</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/backup_info/">备份概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/manual_backup/">创建手动备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/auto_backup/">设置自动备份策略</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/check_backup/">查看备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/restore_from_backup/">从备份恢复集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/replicate_backup/">跨区域复制备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/share_backup/">共享备份</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/backup_restoration/delete_backup/">删除备份</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >日志管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/mgt_log/log_info/">日志概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/mgt_log/enable_log_service/">启动日志服务</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/mgt_log/download_log/">预览和下载日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/mgt_log/disable_log_service/">关闭日志服务</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >监控与告警</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/metrics_alarm/config_display_metrics/">监控指标</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/metrics_alarm/set_alarm_rules/">设置监控告警</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/metrics_alarm/view_monitor_metrics/">查看资源和服务监控</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/metrics_alarm/zabbix_client_service/">Zabbix 监控服务</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/metrics_alarm/node_exporter_service/">Node Exporter 监控服务</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/manual/metrics_alarm/mongodb_exporter_service/">MongoDB Exporter 监控服务</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a >最佳实践</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/best-practices/oplog_size/">分配 oplog 空间</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/best-practices/mtools_log/">mtools 工具查询日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/best-practices/mtool_analyse/">mtools 工具分析日志</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/best-practices/migration_online/">线上集群之间数据同步和迁移最佳实践</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/best-practices/zabbix/">配置 Zabbix Server 监控 MongoDB 集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item active current">
            <a href="/v6.1/database/mongodb/best-practices/psync_migrate/">利用 MongoShake 实现 MongoDB 跨集群异步复制</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >性能白皮书</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/perfwp/test_tool/">测试工具</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/perfwp/test_method/">测试方法</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >测试数据</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/perfwp/test_data/3.6.8_version/">MongoDB 3.6.8-v1.0.1</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/perfwp/test_data/4.0.3_version/">MongoDB 4.0.3-v1.0.0</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >常见问题</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/faq/kernel_version/">数据库版本</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/faq/para_faq/">数据库参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/database/mongodb/faq/create_faq/">如何避免在创建索引时导致锁库问题？</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
      
    </nav>

  </div>
</aside>
<div class="content-card-wrapper">
  <div class="content-card">
    <div class="content-wrapper"><ul class="content-breadcrumb">
      <li class="icon-slash_fill"><a href="/v6.1" data-url="/v6.1">用户指南</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/database/mongodb" data-url="/v6.1/database/mongodb">文档数据库 MongoDB</a></li>
        
        <li class="icon-slash_fill"><a href="/v6.1/database/mongodb/best-practices/oplog_size/" data-url="/v6.1/database/mongodb/best-practices">最佳实践</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/database/mongodb/best-practices/psync_migrate" data-url="/v6.1/database/mongodb/best-practices/psync_migrate">利用 MongoShake 实现 MongoDB 跨集群异步复制</a></li></ul><div class="post-wrapper"><div class="post">
  <h1 class="post-title">
    利用 MongoShake 实现 MongoDB 跨集群异步复制</h1>
  <div class="post-info">
    <div class="post-date">
      更新时间：2024-03-07 19:06:53
    </div>
    
    
    
    
    
    
    
      <div
        class="tag post-tag export-pdf has-tooltip-top has-tooltip-arrow"
        data-tooltip="下载范围：所属一级目录的全部内容"
        data-url="/v6.1/database/mongodb/best-practices">
        <span class="icon-format_pdf_2_fill"></span>
        PDF
      </div>
      
    
  </div><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_场景描述">场景描述</a></li>
    <li><a href="#_前提条件">前提条件</a></li>
    <li><a href="#_操作步骤">操作步骤</a>
      <ul>
        <li><a href="#_第1步基本设置">第1步：基本设置</a></li>
        <li><a href="#_第2步节点设置">第2步：节点设置</a></li>
        <li><a href="#_第3步网络设置">第3步：网络设置</a></li>
        <li><a href="#_第4步服务环境参数设置">第4步：服务环境参数设置</a></li>
        <li><a href="#_第5步查看异步复制监控">第5步：查看异步复制监控</a></li>
        <li><a href="#_mongoshake_参数介绍">MongoShake 参数介绍</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div><div class="post-content">
    
      
      
<div class="sect1">
<h2 id="_场景描述">场景描述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MongoDB 两个集群之间可通过 MongoShake 进行跨集群的数据异步复制，实现灾备和多活的业务场景，同时也免去双写的业务开销。</p>
</div>
<div class="paragraph">
<p>MongoShake 异步复制原理为从源库抓取 oplog 数据，然后发送到各个不同的 tunnel 通道，用户可以通过对接 tunnel 通道获取关注的数据，例如对接 Direct 通道直接写入目的 MongoDB，或者对接 RPC 进行同步数据传输等。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/cloud_service/database/mongodb/mongoshake_00.png" alt="mongoshake"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_前提条件">前提条件</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>已创建源集群和目的集群。</p>
</li>
<li>
<p>已获取源集群和目的集群的 IP 地址、对所有的集合可进行读写复制的账户以及登录密码。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_操作步骤">操作步骤</h2>
<div class="sectionbody">
<div class="paragraph">
<p>进入 MongoShake 集群创建界面。</p>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>MongoShake 环境入口请提交工单或联系管理员获取。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_第1步基本设置">第1步：基本设置</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在顶部<strong>区域</strong>下拉框中，选择部署区域。</p>
</li>
<li>
<p>填写 MongoShake 集群的基本信息，包括：名称、描述、选择版本、计费方式、自动备份时间、部署方式和可用区。</p>
<div class="imageblock">
<div class="content">
<img src="/images/cloud_service/database/mongodb/mongoshake_01.png" alt="基本设置"/>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_第2步节点设置">第2步：节点设置</h3>
<div class="paragraph">
<p>选择主机类型、CPU和内存规格。主机类型推荐选择<code>企业型 e3</code>，实际请根据集群情况选择规格。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/cloud_service/database/mongodb/mongoshake_02.png" alt="节点设置"/>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_第3步网络设置">第3步：网络设置</h3>
<div class="paragraph">
<p>选择 VPC 网络、私有网络以及节点 IP 类型。</p>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>VPC 网络和私有网络需选择能够同时访问到源集群与目标集群的网络。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="/images/cloud_service/database/mongodb/mongoshake_03.png" alt="网络设置"/>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_第4步服务环境参数设置">第4步：服务环境参数设置</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>填写参数。参数介绍请参见 <a href="#_mongoshake_参数介绍">MongoShake 参数介绍</a>。</p>
<div class="imageblock">
<div class="content">
<img src="/images/cloud_service/database/mongodb/mongoshake_04.png" alt="网络设置"/>
</div>
</div>
</li>
<li>
<p>点击<strong>校验表单参数</strong>。</p>
</li>
<li>
<p>待提示校验成功，点击<strong>提交</strong>。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_第5步查看异步复制监控">第5步：查看异步复制监控</h3>
<div class="paragraph">
<p>待 MongoShake 集群创建成功，集群状态为<code>活跃</code>，集群节点服务状态为<code>正常</code>。在节点页签服务和资源监控页面可查看集群异步复制情况。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/cloud_service/database/mongodb/mongoshake_05.png" alt="查看"/>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mongoshake_参数介绍">MongoShake 参数介绍</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;"/>
<col style="width: 16.6666%;"/>
<col style="width: 66.6668%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">取值范围</th>
<th class="tableblock halign-left valign-top">参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">master_quorum</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>表示是否启动主备模式。默认为 false。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>false：表示只能启动 1 个 MongoShake。</p>
</li>
<li>
<p>true：表示用户可以启动 2 个mongoshake，拉取同一个源MongoDB，MongoShake 将会自动选主节点，备节点在监测到主节点故障后，会接管过同步服务。<br/>
如果主节点在全量同步阶段故障，备节点将接管服务避免造成断点续传，而是会从头开始同步，且如果配置项不当，可能还会有报错。主备模式主要用于在<strong>增量环节</strong>的 HA 容错切换。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log.level</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>debug</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>warning</p>
</li>
<li>
<p>错误</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示日志的级别。默认为 <code>info</code>。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sync_mode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>all</p>
</li>
<li>
<p>full</p>
</li>
<li>
<p>incr</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>表示同步模式，默认为全量+增量 。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all：表示全量+增量同步，全量同步完毕以后进入增量同步。</p>
</li>
<li>
<p>full：表示仅进行全量同步，全量同步后进程将会退出。</p>
</li>
<li>
<p>incr：表示仅进行增量同步（默认），从给定的 checkpoint 开始拉取增量数据。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync: source address of MongoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">填写源集群任一从节点 IP 地址，只能输入 1 个 IP 地址，例如：127.0.0.1:27017。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync: source user of MongoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">填写源集群账户名，该账户需拥有对源集群所有的集合进行读、写、复制等权限。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync: source user’s password of MongoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">填写源集群上述账户名的所属密码。<br/>
必须包含大小写字母和数字的组合, 可使用特殊字符（包括 @#%&amp;*()_+-=）, 长度在 8-32 之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync: destination address of MongoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">填写目标集群主节点 IP 地址，只能输入 1 个 IP 地址，例如：127.0.0.1:27017。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync: destination user of MongoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">填写目标集群账户名，该账户需拥有对源集群所有的集合进行读、写、复制等权限。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync: destination user’s password of MongoDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">填写目标集群上述账户名的所属密码。<br/>
必须包含大小写字母和数字的组合, 可使用特殊字符（包括 @#%&amp;*()_+-=）, 长度在 8-32 之间。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">full_sync_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025 - 65535</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全量阶段对外提供restful接口，用户可以查看内部监控的情况，默认 9101 。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">incr_sync_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025 - 65535</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">增量阶段对外提供restful接口，用户可以查看内部监控的情况，默认 9100。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">system_profile_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025 - 65535</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Profile 端口，用户可以查看内部运行堆栈信息，默认 9200。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">隧道服务</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>direct</p>
</li>
<li>
<p>rpc</p>
</li>
<li>
<p>tcp</p>
</li>
<li>
<p>file</p>
</li>
<li>
<p>kafka</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示通道类型。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo_connect_mode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>primary</p>
</li>
<li>
<p>secondaryPreferred</p>
</li>
<li>
<p>standalone</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>表示源端拉取模式。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>primary：表示从主节点拉取。</p>
</li>
<li>
<p>secondaryPreferred（默认）：表示优先从 secondary 拉取，没有的话将会从 primary 拉取。</p>
</li>
<li>
<p>standalone：表示从给定的单个节点拉取。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果源端是 sharding，版本小于3.6，且是全量同步（sync_mode=full），或者全量+增量同步（sync_mode=incr），建议这里配置 primary 以避免孤儿文档，详情可参考 <a href="https://github.com/alibaba/MongoShake/issues/392">MongoShake 从 mongos 拉取仍旧存在 duplicate key error</a>。</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter.namespace.black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示黑名单过滤。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter.namespace.white</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示白名单过滤。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter.pass.special.db</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指定特殊的 namespace 通过,比如 admin, system.views, mongoshake, config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter.ddl_enable</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>表示是否同步 DDL，默认为 false。<br/>
DML 语句包括普通的 insert，update，delete，DDL语句包括建/删索引，建/删库表，rename 库表，事务等数据库结构的操作。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>false 只同步 DML。</p>
</li>
<li>
<p>用户可以设置为 true 对 DDL 进行同步。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpoint.storage.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示标识 checkpoint 存储的位置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpoint.storage.db</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpoint 存储的库名，默认 mongoshake。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpoint.storage.collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpoint 存储的表名地址，默认 ckpt_default。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpoint.start_position</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>指定开始拉取 oplog 的位点，默认 <code>1970-01-01T00:00:01Z。</code><br/>
仅用于 sync_mode 是 oplog 的情况，第一次将会从这个指定的位点开始拉取。其格式是 <strong>UTC</strong> 的时间戳：2000-01-01T00:00:01Z。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>若 checkpoint 在给定位置存在（参见 checkpoint.storage.url 和 checkpoint.address），那么将会从checkpoint 位置开始同步，忽略checkpoint.start_position 参数。</p>
</li>
<li>
<p>若 checkpoint 不存在，且该值为1970-01-01T00:00:01Z，则会拉取源端所有 oplog。</p>
</li>
<li>
<p>若 checkpoint 不存在，且该值不为 1970-01-01T00:00:01Z，则会先检查源端 oplog 最老的时间是否大于给定的时间，如果是则会直接报错退出。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>所以，如果需要强制该位置开始拉取，在需要保证该位点有效的情况下，还需要删除原来的 checkpoint。（用户可以通过 <code>rs.printReplicationInfo</code> 查看最老 oplog 的信息。）</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transform.namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是否开启命名空间转换，比如源库的 a.b，转换到目的库变成 c.d，默认不开启。<br/>
开启将会消耗比较大的资源，从而导致同步速率的大幅度的降低。谨慎建议开启。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reader.collection_parallel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">表示一次最大并发拉取的表的数目，默认 6。（范围: - 10）<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reader.write_document_parallel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">对一个表内部,启动多少个线程进行并发写入，默认 8。（范围: - 10）<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collection_exist_drop</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>目的端存在同样的表,是否需要先删除再进行同步，默认开启。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>false：表示不删除直接同步，但可能会存在 _id 一样的文档从而报错。（参考 full_sync.executor.* 相关参数。）</p>
</li>
<li>
<p>true：表示在目的端先删除对应的表再进行同步。</p>
</li>
<li>
<p>集群创建成功后不可修改。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">create_index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>-</p>
</li>
<li>
<p>foreground</p>
</li>
<li>
<p>background</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>全量期间数据同步完毕后,是否需要创建索引，默认 background。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>foreground：表示前台创建索引。</p>
</li>
<li>
<p>-：表示不创建。</p>
</li>
<li>
<p>background：表示后台创建索引，2.4.1 版本开始支持。</p>
</li>
<li>
<p>集群创建成功后不可修改。</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executor.insert_on_dup_update</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果 _id 存在在目的库,是否将 insert 语句修改为 update 语句，默认不开启。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">executor.majority_enable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">全量阶段写入端是否启用 majority write，默认 false。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo_fetch_method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">从源 MongoDB 拉取增量的方式，默认 oplog。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">worker 线程的个数，默认为 8。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tunnel.write_thread</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">控制序列化的线程个数，默认为 1 个 tunnel（worker）对应 1 个。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target_delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">控制延迟同步的时间，目的端可以落后于源端指定的秒数。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">incr_sync.executor.upsert</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果 _id 不存在在目的库，是否将 update 语句修改为 insert 语句，默认 false。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">incr_sync.executor.insert_on_dup_update</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果 _id 存在在目的库,是否将 insert 语句修改为 update 语句，默认 false。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">incr_sync.conflict_write_to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果写入存在冲突，记录冲突的文档.db 表示将冲突记录到 checkpoint url 对应的 db 里面，sdk 表示写入 sdk（开源没有用），默认 none。<br/>
集群创建成功后不可修改。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">incr_sync.majority_enable</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">增量阶段写入端是否启用 majority write，默认false。<br/>
集群创建成功后不可修改。</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

    

  </div>
  <div class="post-footer">
    <div class="post-prev">
    </div>
    <div class="post-next">
    </div>
  </div>
  <div class="post-back-to-top">
    <span class="icon-up_3_fill"></span>
  </div>
</div>
<div class="post-placeholder"><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_场景描述">场景描述</a></li>
    <li><a href="#_前提条件">前提条件</a></li>
    <li><a href="#_操作步骤">操作步骤</a>
      <ul>
        <li><a href="#_第1步基本设置">第1步：基本设置</a></li>
        <li><a href="#_第2步节点设置">第2步：节点设置</a></li>
        <li><a href="#_第3步网络设置">第3步：网络设置</a></li>
        <li><a href="#_第4步服务环境参数设置">第4步：服务环境参数设置</a></li>
        <li><a href="#_第5步查看异步复制监控">第5步：查看异步复制监控</a></li>
        <li><a href="#_mongoshake_参数介绍">MongoShake 参数介绍</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div></div>
      </div>
    </div>
  </div>
</div></div>
    </body><script src="/js/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/search/jquery.mark.min.js"></script>

<script type="text/javascript" src="/js/common.428b8a7f426567136e0501d49705f10dac2e4539d10c2f396d7c9ee45df1469eaa38e983928589e0e35ed30c1732ddbcda694ac0928ffffffee76b4a0017adf2.js" integrity="sha512-QouKf0JlZxNuBQHUlwXxDawuRTnRDC85bXye5F3xRp6qOOmDkoWJ4ONe0wwXMt282mlKwJKP///&#43;52tKABet8g=="></script>

<script type="text/javascript" src="/js/search.d8001c3e1b66b9a0b48e0c23ad0dbfc0906f194f8925ae78a9900b960679cfa7e41cebd9efd654f84535d02cbce7c4971f226e6f07288c26c3c4560c36d7655b.js"></script>
<script>
  $(function() {
    
    hljs.highlightAll();
    
    $.each($('.post-content .imageblock img'), function () {
      $(this).attr('data-mfp-src', $(this).attr('src'));
    });
    $('.post-content').magnificPopup({
      disableOn: function () {
        if ($(window).width() < 600) {
          return false;
        }
        return true;
      },
      delegate: '.imageblock img',
      type: 'image',
      gallery: {
        enabled: true,
      },
    });
  });
</script>
</html>
