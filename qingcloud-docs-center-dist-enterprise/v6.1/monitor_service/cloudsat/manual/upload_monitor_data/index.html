




<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<meta name="keywords" content="[自定义监控, 自定义监控上报数据规范, CloudSat]">


<meta name="description" content="这里是企业云文档页面">

<link rel="icon" href="https://console.petaexpress.com/assets/cdn/hinata/0a234310-78f9-4323-8d59-2b36ac15120a-favicon.ico" type="image/x-icon">

<title>自定义监控上报数据规范 - 用户指南</title>
<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/bulma-tooltip.min.css" rel="stylesheet">
<link href="/css/atom-one-light.css" rel="stylesheet" />
<link href="/css/magnific-popup.css" rel="stylesheet" />


<link href="/scss/main.min.e407fb236ca21333e8c63516ab2f144dd2cdbdaf2eca08e58895ff89ce74abc3.css" rel="stylesheet" integrity="sha256-5Af7I2yiEzPoxjUWqy8UTdLNva8uygjliJX/ic50q8M=">

<script src="/js/jquery-2.2.4.js"></script>
<body
        class="root   "
        style=""
        ><header>
  <nav class="navbar">
    
      <a href="/" class="navbar-logo-wrapper">
        <img class="navbar-logo" src="https://console.petaexpress.com/assets/cdn/hinata/ba65c1e6-b7a4-4085-b0e2-23104d8e71e1-logo_en.svg" />
        <div class="navbar-split navbar-left-split">|</div>
        <div class="navbar-logo-text">企业云</div>
      </a>
    
    <div class="navbar-nav">
      <div
        class="navbar-nav-item navbar-nav-version "
        style="display:none;">
        
        <div class="dropdown-trigger">
          <span class="project-version">
            v6.1
          </span>
          
        </div>
        
      </div>
      
    </div>
    <div class="search navbar-search">
      <form action="/v6.1/search/" method="GET">
        <div class="control has-icons-left has-icons-right docs-search-input">
          <span class="icon is-left">
            <img src="/images/icons/magnifier_duotone.svg" />
          </span>
          <input
            class="input"
            name="q"
            type="input"
            placeholder="请输入关键字快速获取帮助"
            autocomplete="off"
          />
          <span class="icon is-right"> </span>
        </div>
        <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
      </form>
      <div class="search-result navbar-search-result">
        <div class="search-result-loading"></div>
        <div class="search-result-content"></div>
        <div class="search-result-none">
          没有找到搜索结果， 请更换关键词重新搜索
        </div>
      </div>
    </div>
    
      
      
        
          <a class="navbar-item-right btn primary-btn navbar-btn "
            target="_blank"
            data-url="https://console.petaexpress.com"
            data-text="控制台"
            href="https://console.petaexpress.com">
            控制台
          </a>
        
      
    
  </nav>
</header><script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>

<script id="search-result-item-template" type="text/x-js-template">
  <div class="search-result-content-item">
    <div class="search-result-content-item-title">
      <a href="${href}">${title}</a>
    </div>
    <div class="search-result-content-item-content">
      ${content}
    </div>
    <div class="search-result-content-item-ref">
      <ul class="content-breadcrumb">
      </ul>
    </div>
  </div>
</div>
</script>

<script id="search-breadcrumb-template" type="text/x-js-template">
  <li class="icon-slash_fill">
    <a href="${href}">${title}</a>
  </li>
</script>

<script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>
<script id="search-result-page-template" type="text/x-js-template">
  <nav class="search-result-pagination pagination is-centered">
    <a class="pagination-previous icon-chevron_left_fill"></a>
    <a class="pagination-next icon-chevron_right_fill"></a>
    <ul class="pagination-list">
    </ul>
  </nav>
</script>
<div class="container">

  


  
    
  


<aside class="sidebar-wrapper">
  <div class="sidebar-drag"></div>
  <div class="sidebar">
    
      <div class="sidebar-title" >
        <a href="/v6.1/monitor_service/cloudsat/">
          
            云监控 CloudSat
        </a>
        
          <span class="icon-menu_fill"></span>
        
      </div>
      
        <div class="search-sidebar-wrapper">
          
<div class="search search-sidebar">
  <div class="control has-icons-left has-icons-right docs-search-input">
    <span class="icon is-left">
      <img src="/images/icons/magnifier_duotone.svg" />
    </span>
    <input class="input" name="q" type="input" placeholder="请输入关键字快速获取帮助" autocomplete="off" />
    <span class="icon is-right"> </span>
  </div>
  <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
</div>
<div class="search-sidebar-result columns">
  
    <div class="column">
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-computing_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">计算</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/compute/vm/">
      云服务器
    </a>
    
    <a href="/v6.1/compute/hpc/">
      弹性高性能计算 EHPC
    </a>
    
    <a href="/v6.1/compute/image/">
      镜像
    </a>
    
    <a href="/v6.1/compute/ssh/">
      SSH 密钥
    </a>
    
    <a href="/v6.1/compute/instance_group/">
      安置策略组
    </a>
    
    <a href="/v6.1/compute/migration/">
      跨区域迁移
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-database_cache_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据库</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/database/mysql/">
      关系型数据库 MySQL Plus
    </a>
    
    <a href="/v6.1/database/postgresql/">
      关系型数据库 PostgreSQL
    </a>
    
    <a href="/v6.1/database/radondb/">
      分布式数据库 RadonDB
    </a>
    
    <a href="/v6.1/database/polondb/">
      分布式数据库 PolonDB
    </a>
    
    <a href="/v6.1/database/chronusdb/">
      时序数据库 ChronusDB
    </a>
    
    <a href="/v6.1/database/mongodb/">
      文档数据库 MongoDB
    </a>
    
    <a href="/v6.1/database/mongodb_cluster/">
      文档数据库 MongoDB Cluster
    </a>
    
    <a href="/v6.1/database/redis_standalone/">
      键值数据库 Redis Standalone
    </a>
    
    <a href="/v6.1/database/redis_cluster/">
      键值数据库 Redis Cluster
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-container_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">容器</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/container/qke_plus/">
      容器引擎 QKE
    </a>
    
    <a href="/v6.1/container/harbor/">
      Harbor 镜像仓库
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-operation_manage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">运维与管理</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/operation/migration/">
      服务器迁移中心
    </a>
    
    <a href="/v6.1/operation/topology/">
      资源编排
    </a>
    
    <a href="/v6.1/operation/resource/">
      资源管理
    </a>
    
    <a href="/v6.1/operation/autoscaling/">
      自动伸缩
    </a>
    
    <a href="/v6.1/operation/tools/">
      运维工具
    </a>
    
    <a href="/v6.1/operation/vmware/">
      VMware 纳管
    </a>
    
  </div>
</div>
        
      
        
      
    </div>
    <div class="column">
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-storage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">存储</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/storage/disk/">
      硬盘
    </a>
    
    <a href="/v6.1/storage/backup/">
      备份
    </a>
    
    <a href="/v6.1/storage/object_storage/">
      对象存储
    </a>
    
    <a href="/v6.1/storage/epfs/">
      文件存储 EPFS
    </a>
    
    <a href="/v6.1/storage/vnas/">
      文件存储 vNAS
    </a>
    
    <a href="/v6.1/storage/qfs/">
      文件存储 QFS
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-mq_middleware_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">消息队列与中间件</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/middware/kafka/">
      Kafka 服务
    </a>
    
    <a href="/v6.1/middware/rabbitmq/">
      RabbitMQ 服务
    </a>
    
    <a href="/v6.1/middware/etcd/">
      Etcd 服务
    </a>
    
    <a href="/v6.1/middware/api_gateway/">
      API 网关
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-shield_key_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">安全</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/security/firewall/">
      云防火墙 CFW
    </a>
    
    <a href="/v6.1/security/srp/">
      安全资源池
    </a>
    
    <a href="/v6.1/security/hss/">
      主机安全
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-data_warehouse_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">用户服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/services/bill_center/">
      费用中心
    </a>
    
    <a href="/v6.1/services/notification-center/">
      消息中心
    </a>
    
    <a href="/v6.1/services/vdc/">
      企业管理
    </a>
    
  </div>
</div>
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-nat_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">网络服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/network/vpc/">
      VPC 网络
    </a>
    
    <a href="/v6.1/network/nat_gateway/">
      NAT 网关
    </a>
    
    <a href="/v6.1/network/eip/">
      弹性公网 EIP
    </a>
    
    <a href="/v6.1/network/loadbalancer/">
      负载均衡
    </a>
    
    <a href="/v6.1/network/border_router/">
      边界路由器
    </a>
    
    <a href="/v6.1/network/security_group/">
      安全组
    </a>
    
    <a href="/v6.1/network/acl/">
      网络访问控制
    </a>
    
    <a href="/v6.1/network/mcn/">
      流量牵引服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bigdata_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">大数据服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/bigdata/elk/">
      ELK 服务
    </a>
    
    <a href="/v6.1/bigdata/opensearch/">
      OpenSearch 服务
    </a>
    
    <a href="/v6.1/bigdata/zookeeper/">
      ZooKeeper 服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-monitor_service_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">监控服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/monitor_service/cloudsat/">
      云监控 CloudSat
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-apps_5_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">AppCenter</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/appcenter/market/">
      AppCenter 控制台
    </a>
    
    <a href="/v6.1/appcenter/dev-platform/">
      应用开发平台
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bi_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据仓库与 BI</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/dwh_bi/clickhouse/">
      ClickHouse
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-human_gear_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">访问与鉴权</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/authorization/iam/">
      访问鉴权管理
    </a>
    
    <a href="/v6.1/authorization/account/">
      账户中心
    </a>
    
    <a href="/v6.1/authorization/access_key/">
      API 密钥
    </a>
    
  </div>
</div>
      
      
      
      
      
      
    </div>
  
</div>
        </div>
      
    
    <nav class="sidebar-menu">
      
        
        <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >产品简介</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/intro/intro/">CloudSat 简介</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/intro/function_list/">功能简介</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >计费指南</a>
            
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/billing/price/">计费说明</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a >操作指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/monitoring_overview/">监控概览</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/dashboard/">Dashboard</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/group_management/">分组管理</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/event_monitor/">事件监控</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/alarm_service/">告警服务</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v6.1/monitor_service/cloudsat/manual/alarm_service_new/">告警服务（新版）</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/alarm_service_new/alarm_policy/">告警策略</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/alarm_service_new/alarm_history/">告警记录</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/alarm_service_new/alarm_onekey/">一键告警</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/v6.1/monitor_service/cloudsat/manual/cloud_service/">云服务监控</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/cloud_service/load_balancer/">负载均衡</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/cloud_service/service/">应用服务</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/manual/custom_monitor/">自定义监控</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item active current">
            <a href="/v6.1/monitor_service/cloudsat/manual/upload_monitor_data/">自定义监控上报数据规范</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >最佳实践</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/best-practices/webhook-dtalk/">Webhook 配置钉钉通知</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/best-practices/show-all-resource/">全栈资源监控统一展示</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/best-practices/resource-alarm/">通过分组管理和告警功能构建大批量资源监控告警机制</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/best-practices/panic-check/">异常处理排查</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/best-practices/event-statistic/">周期时间内重大事件统计</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/best-practices/resource-tops/">资源用量排行</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >常见问题</a>
            
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/monitor_service/cloudsat/faq/faq/">常见问题</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
      
    </nav>

  </div>
</aside>
<div class="content-card-wrapper">
  <div class="content-card">
    <div class="content-wrapper"><ul class="content-breadcrumb">
      <li class="icon-slash_fill"><a href="/v6.1" data-url="/v6.1">用户指南</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/monitor_service/cloudsat" data-url="/v6.1/monitor_service/cloudsat">云监控 CloudSat</a></li>
        
        <li class="icon-slash_fill"><a href="/v6.1/monitor_service/cloudsat/manual/monitoring_overview/" data-url="/v6.1/monitor_service/cloudsat/manual">操作指南</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/monitor_service/cloudsat/manual/upload_monitor_data" data-url="/v6.1/monitor_service/cloudsat/manual/upload_monitor_data">自定义监控上报数据规范</a></li></ul><div class="post-wrapper"><div class="post">
  <h1 class="post-title">
    自定义监控上报数据规范</h1>
  <div class="post-info">
    <div class="post-date">
      更新时间：2024-03-07 19:06:53
    </div>
    
    
    
    
    
    
    
      <div
        class="tag post-tag export-pdf has-tooltip-top has-tooltip-arrow"
        data-tooltip="下载范围：所属一级目录的全部内容"
        data-url="/v6.1/monitor_service/cloudsat/manual">
        <span class="icon-format_pdf_2_fill"></span>
        PDF
      </div>
      
    
  </div><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_uploadmonitordata_接口_url_构造规范">UploadMonitorData 接口 URL 构造规范</a></li>
    <li><a href="#_uploadmonitordata_接口数据规范">UploadMonitorData 接口数据规范</a></li>
    <li><a href="#_构造请求串方法">构造请求串方法</a>
      <ul>
        <li><a href="#_步骤_1参数升序排列">步骤 1：参数升序排列</a></li>
        <li><a href="#_步骤_2参数_url_编码">步骤 2：参数 URL 编码</a></li>
        <li><a href="#_步骤_3构造_url_请求">步骤 3：构造 URL 请求</a></li>
        <li><a href="#_步骤_4构造被签名串">步骤 4：构造被签名串</a></li>
        <li><a href="#_步骤_5计算签名">步骤 5：计算签名</a></li>
        <li><a href="#_步骤_6添加签名">步骤 6：添加签名</a></li>
      </ul>
    </li>
    <li><a href="#_示例代码">示例代码</a>
      <ul>
        <li><a href="#_golang_示例">Golang 示例</a></li>
        <li><a href="#_python_完整上传自定义数据示例">python 完整上传自定义数据示例</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div><div class="post-content">
    
      
      
<div class="paragraph">
<p>目前上报自定义监控数据通过 CloudSat 中 <code>UploadMonitorData</code> 接口进行上报，需遵循自定义监控上报 URL 构造规范和接口数据规范。用户可以通过 <code>UploadMonitorData</code> 接口上报自定义的数据，然后进行监控数据分析和告警。</p>
</div>
<div class="sect1">
<h2 id="_uploadmonitordata_接口_url_构造规范">UploadMonitorData 接口 URL 构造规范</h2>
<div class="sectionbody">
<div class="paragraph">
<p>上传数据 <code>UploadMonitorData</code> 接口说明，接口采用 <code>post</code> 方法发送请求，请求 URL 需要构造，构造方法如下：</p>
</div>
<div class="paragraph">
<p><strong>构造 URL 方法</strong>：构造前 URL + &#34;?&#34; + 构造验证请求串。</p>
</div>
<div class="paragraph">
<p><strong>构造前 URL</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>http://cloudsat.qingcloud.com/api/:zone/v1/custom/UploadMonitorData</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>构造完成之后请求 URL 即最终 <code>UploadMonitorData</code> 接口请求 URL，URL 里面<code>：zone</code>，请根据具体分区信息填写，如<code>上海 1 区 sh1</code>，文中其他地方类似。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>分区信息参考：<code>北京 3 区</code>（pek3）、<code>北京 3 区-A</code>（pek3a）、<code>上海 1 区</code>（sh1）、<code>广东 2 区</code>（gd2）、<code>亚太 2 区-A</code>（ap2a）</p>
</div>
<div class="paragraph">
<p><strong>构造验证请求串示例</strong>：构造验证请求串方法详见下面说明（下方为示例，请自行参照后文构造验证请求串方法进行构造）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>access_key_id=CCDJRDKCCKZYTEXANZJD&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2020-12-23T13%3A32%3A34Z&amp;version=1&amp;zone=sh1&amp;signature=sOdokWwvYJ80mM%2FxYbBTsgTgQl3iu%2F2WDXWjgKFPNNs%3D</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>这部分请根据实际参数进行构造。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>由于上面构造前 URL 上传监控数据需要对请求进行验证，这里采用类似 <strong>API 请求中签名（signature）</strong> 的生成方法，构造验证请求串，拼接在上面构造前 URL 后面。由于需要去 iaas 对用户信息进行确认，所以这里选择 <code>DescribeUsers</code> 这个 action 去构造签名信息。</p>
</div>
<div class="paragraph">
<p><strong>构造完成后请求 URL 示例为</strong>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>http://cloudsat.qingcloud.com/api/:zone/v1/custom/UploadMonitorData?access_key_id=CCDJRDKCCKZYTEXANZJD&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2020-12-23T13%3A32%3A34Z&amp;version=1&amp;zone=sh1&amp;signature=sOdokWwvYJ80mM%2FxYbBTsgTgQl3iu%2F2WDXWjgKFPNNs%3D</code></pre>
</div>
</div>
<div class="paragraph">
<p>下面为在<code>上海 1 区</code>，完成构建验证请求串之后拼接生成的一个最终 api 请求 URL 实例，请根据实际分区信息和构造的验证串拼接构造相应的最终 api 请求 URL。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>http://cloudsat.qingcloud.com/api/sh1/v1/custom/UploadMonitorData?access_key_id=CCDJRDKCCKZYTEXANZJD&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2020-12-23T13%3A32%3A34Z&amp;version=1&amp;zone=sh1&amp;signature=sOdokWwvYJ80mM%2FxYbBTsgTgQl3iu%2F2WDXWjgKFPNNs%3D</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uploadmonitordata_接口数据规范">UploadMonitorData 接口数据规范</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>描述</strong>：上传监控数据。</p>
</div>
<div class="paragraph">
<p><strong>请求类型</strong>：<code>POST</code>。</p>
</div>
<div class="paragraph">
<p><strong>请求 URL</strong>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>http://cloudsat.qingcloud.com/api/:zone/v1/custom/UploadMonitorData?access_key_id=QEJMCFROGCAPHUOAJMRN&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2020-10-13T10%3A28%3A33Z&amp;version=1&amp;zone=test&amp;signature=SO9ZufFb69Om21bK%2BH7Gs6f%2FuuDljHh41STgIX%3D</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch admon attention">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>请仔细阅读上文说明，根据实际情况构造验证请求串，拼接成最终 api 请求 URL 并替换<code>:zone </code>信息。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Headers</strong>：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 12.5%;"/>
<col style="width: 25%;"/>
<col style="width: 12.5%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数</th>
<th class="tableblock halign-left valign-top">参数值</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">示例</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content-Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#39;Content-Type&#39;:&#39;application/json&#39;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不可缺少</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>请求 body 格式</strong>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
    &#34;user_id&#34;: &#34;usr-123456&#34;,
    &#34;namespace&#34;: &#34;namespace-1&#34;,
    &#34;data&#34;: [
      {
          &#34;source&#34;: &#34;test&#34;,
          &#34;user_id&#34;: &#34;usr-KJ8DrfQT&#34;,
          &#34;tags&#34;: &#34;role=master,interface=eth10&#34;,
          &#34;group_id&#34;: &#34;group10&#34;,
          &#34;resource_id&#34;: &#34;i-instance-10&#34; ,
          &#34;resource_name&#34;: &#34;name10&#34;,
          &#34;resource_type&#34;: &#34;instance&#34;,
          &#34;root_user_id&#34;: &#34;usr-KJ8DrfQ&#34;,
          &#34;meter&#34;: &#34;disk_ri&#39;&#34;,
          &#34;region&#34;: &#34;sh1&#34;,
          &#34;value&#34;: 99,
          &#34;value_type&#34;: &#34;percent&#34;,
           &#34;time_stamp&#34;:&#34;2020-11-03T09:58:44Z&#34;
         },{
          &#34;source&#34;: &#34;test&#34;,
          &#34;user_id&#34;: &#34;usr-KJ8DrfQT&#34;,
          &#34;tags&#34;: &#34;role=master,interface=eth10&#34;,
          &#34;group_id&#34;: &#34;group10&#34; ,
          &#34;resource_id&#34;: &#34;i-instance-10&#34;,
          &#34;resource_name&#34;: &#34;name10&#34; ,
          &#34;resource_type&#34;: &#34;instance&#34;,
          &#34;root_user_id&#34;: &#34;usr-KJ8DrfQ&#34;,
           &#34;meter&#34;: &#34;diskio&#34;,
          &#34;region&#34;: &#34;sh1&#34;,
          &#34;value&#34;: 88,
          &#34;value_type&#34;: &#34;percent&#34;,
          &#34;time_stamp&#34;:&#34;2020-11-03T09:58:44Z&#34;
         }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>字段说明</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;"/>
<col style="width: 14.2857%;"/>
<col style="width: 28.5714%;"/>
<col style="width: 14.2857%;"/>
<col style="width: 28.5715%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">字段</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">举例</th>
<th class="tableblock halign-left valign-top">必填</th>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">命名空间</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">region</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sh1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">region id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控数据的来源</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">group_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">group_1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控数据的 group，或者分组标记</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-12345678</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控数据关联的资源 id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">roger-test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控数据关联的资源名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">资源类型</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usr-123456</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控资源资源对应用户的 id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">root_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usr-123456</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">主账户 id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">meter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控指标，请于该命名空间下监控配置中的监控指标名称保持一致</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">指标值的类型，例如：raw（原格式） percent（百分比）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控的数据，整型的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">time_stamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-12-16T11:14:32Z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">监控数据时间（UTC）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">role=master,cln-node=node-1,interface=eth0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据的 tags，用于归类，都是 key，value 的形式，用于 like 查询，理论上存储的 key 都是按层级往后排，比如资源的下一级是 role，role 的下一级是节点，节点下有网卡</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>返回结果</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
    &#34;data&#34;: {
        &#34;upload_count&#34;: 2
    },
    &#34;ret_code&#34;: 0
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果说明：<code>ret_code</code> 为 0 时表示上传数据成功，<code>data</code> 中 <code>upload_count</code> 表示上传数据条数。</p>
</div>
<div class="paragraph">
<p>自定义页面监控列表中涉及到一些时间区间内的监控数据计算，最小统计周期为 5 分钟，因此需连续发送一段时间（不小于 5 分钟）页面才有数据显示。</p>
</div>
<div class="paragraph">
<p>数据格式例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
    &#34;user_id&#34;: &#34;usr-12345678&#34;,
    &#34;namespace&#34;: &#34;ns1&#34;,
    &#34;data&#34;: [
     {
        &#34;region&#34;: &#34;sh1&#34;,
        &#34;source&#34;: &#34;custom&#34;,
        &#34;user_id&#34;: &#34;testuser&#34;,
        &#34;group_id&#34;: &#34;group_1&#34;,
        &#34;resource_id&#34;: &#34;resource_id1&#34;,
        &#34;resource_name&#34;: &#34;resource_name2&#34;,
        &#34;resource_type&#34;: &#34;instance&#34;,
        &#34;root_user_id&#34;: &#34;root_user&#34;,
        &#34;meter&#34;: &#34;cpu&#34;,
        &#34;value&#34;: &#34;100&#34;,
        &#34;value_type&#34;: &#34;raw&#34;,
        &#34;tags&#34;:&#34;role=master,interface=eth0&#34;,
        &#34;time_stamp&#34;: &#34;2019-12-16T11:14:32Z&#34;
    },
    {
        &#34;region&#34;: &#34;sh1&#34;,
        &#34;source&#34;: &#34;custom&#34;,
        &#34;user_id&#34;: &#34;testuser&#34;,
        &#34;group_id&#34;: &#34;group_2&#34;,
        &#34;resource_id&#34;: &#34;resource_id1&#34;,
        &#34;resource_name&#34;: &#34;resource_name2&#34;,
        &#34;resource_type&#34;: &#34;instance&#34;,
        &#34;root_user_id&#34;: &#34;root_user&#34;,
        &#34;meter&#34;: &#34;memory&#34;,
        &#34;value&#34;: &#34;90&#34;,
        &#34;value_type&#34;: &#34;raw&#34;,
        &#34;tags&#34;:&#34;role=master,interface=eth0&#34;,
        &#34;time_stamp&#34;: &#34;2019-12-16T11:14:32Z&#34;
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_构造请求串方法">构造请求串方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>您需要先在控制台创建 API 密钥 ，获得 <code>accesss_key_id</code> 和 <code>secret_access_key</code>，这里假设：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>access_key_id = &#39;QYACCESSKEYIDEXAMPLE&#39;
secret_access_key = &#39;SECRETACCESSKEY&#39;</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如：请求参数如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
  &#34;zone&#34;:&#34;sh1&#34;,
  &#34;signature_version&#34;:1,
  &#34;signature_method&#34;:&#34;HmacSHA256&#34;,
  &#34;version&#34;:1,
  &#34;access_key_id&#34;:&#34;QYACCESSKEYIDEXAMPLE&#34;,
  &#34;action&#34;:&#34;DescribeUsers&#34;,
  &#34;time_stamp&#34;:&#34;2013-08-27T14:30:10Z&#34;
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>实际使用过程中请替换成您自己的 <code>AccessKeyId</code>，切换相应区间信息。签名验证可以参考 <strong>API 请求中签名（signature）</strong>，使用链接文档中数据签名结果如果和链接中的一致代表签名方法正确。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_步骤_1参数升序排列">步骤 1：参数升序排列</h3>
<div class="paragraph">
<p>按参数名进行升序排列，排序后的参数为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
  &#34;access_key_id&#34;:&#34;QYACCESSKEYIDEXAMPLE&#34;,
  &#34;action&#34;:&#34;DescribeUsers&#34;,
  &#34;signature_method&#34;:&#34;HmacSHA256&#34;,
  &#34;signature_version&#34;:1,
  &#34;time_stamp&#34;:&#34;2013-08-27T14:30:10Z&#34;,
  &#34;version&#34;:1,
  &#34;zone&#34;:&#34;sh1&#34;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_步骤_2参数_url_编码">步骤 2：参数 URL 编码</h3>
<div class="paragraph">
<p>对参数名称和参数值进行 URL 编码，编码后的请求串为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{
  &#34;access_key_id&#34;:&#34;QYACCESSKEYIDEXAMPLE&#34;,
  &#34;action&#34;:&#34;DescribeUsers&#34;,
  &#34;signature_method&#34;:&#34;HmacSHA256&#34;,
  &#34;signature_version&#34;:1,
  &#34;time_stamp&#34;:&#34;2013-08-27T14%3A30%3A10Z&#34;,
  &#34;version&#34;:1,
  &#34;zone&#34;:&#34;sh1&#34;
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch admon attention">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>编码时，空格要转换成 <code>%20 </code>, 而不是 <code>+</code>。</p>
</li>
<li>
<p>转码部分的字符要用大写，如 <code>:</code> 应转成 <code>%3A</code>，而不是 <code>%3a</code>。</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_步骤_3构造_url_请求">步骤 3：构造 URL 请求</h3>
<div class="paragraph">
<p>参数名和参数值之间用 <code>=</code> 号连接，参数和参数之间用 <code>＆</code> 号连接，构造后的 URL 请求为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>access_key_id=QYACCESSKEYIDEXAMPLE&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2013-08-27T14%3A30%3A10Z&amp;version=1&amp;zone=sh1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_步骤_4构造被签名串">步骤 4：构造被签名串</h3>
<div class="paragraph">
<p>被签名串的构造规则为: 被签名串 = HTTP 请求方式 + “\n” + uri + “\n” +  请求串</p>
</div>
<table class="tableblock frame-all grid-all stretch admon attention">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>“\n” 是换行符，不要将 “\” 转义。也就是说，不要用 “\n” ，有些语言，比如 php 和 ruby ，请用 “\n” , 而不是 ‘\n’。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>假设 HTTP 请求方法为 GET 请求的uri路径为 “/iaas/” , 则被签名串为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>GET\n/iaas/\naccess_key_id=QYACCESSKEYIDEXAMPLE&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2013-08-27T14%3A30%3A10Z&amp;version=1&amp;zone=sh1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_步骤_5计算签名">步骤 5：计算签名</h3>
<div class="paragraph">
<p>计算被签名串的签名 signature。</p>
</div>
<div class="paragraph">
<p>将 API 密钥的私钥（secret_access_key） 作为 key，生成被签名串的 HMAC-SHA256 或者 HMAC-SHA1 签名，更多信息可参见 RFC2104
将签名进行 Base64 编码。
将 Base64 编码后的结果进行 URL 编码。</p>
</div>
<table class="tableblock frame-all grid-all stretch admon attention">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>当 Base64 编码后存在空格时，不要对空格进行 URL 编码，而要直接将空格转为 “”，以 Python（版本 2.7）代码为例（其他语言类似，需要使用 sha256 + base64 编码，最后需要再进行 URL 编码，URL 编码时需要将原有的空格 “ ” 转为 “”）。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>import base64
import hmac
import urllib
from hashlib import sha256

# 前面生成的被签名串
string_to_sign = &#39;GET\n/iaas/\naccess_key_id=QYACCESSKEYIDEXAMPLE&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2013-08-27T14%3A30%3A10Z&amp;version=1&amp;zone=sh1&#39;
h = hmac.new(secret_access_key, digestmod=sha256)
h.update(string_to_sign)
sign = base64.b64encode(h.digest()).strip()
signature = urllib.quote_plus(sign)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_步骤_6添加签名">步骤 6：添加签名</h3>
<div class="paragraph">
<p>将签名参数附在原有请求串的最后面，最终的 HTTP 请求串（为了查看方便，我们人为地将参数之间用<code>回车键</code>分隔开）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>access_key_id=QYACCESSKEYIDEXAMPLE
&amp;action=DescribeUsers
&amp;signature_method=HmacSHA256
&amp;signature_version=1
&amp;time_stamp=2013-08-27T14%3A30%3A10Z
&amp;version=1
&amp;zone=sh1
&amp;signature=bOQMI8wJ4ikFnadNXc%2BpnVMcUyf83C7b9JO5%2FAvkGyk%3D</code></pre>
</div>
</div>
<div class="paragraph">
<p>完整的请求串为（为了查看方便，我们人为地将参数之间用<code>回车键</code>分隔开）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>access_key_id=QYACCESSKEYIDEXAMPLE
&amp;action=DescribeUsers
&amp;signature_method=HmacSHA256
&amp;signature_version=1
&amp;time_stamp=2013-08-27T14%3A30%3A10Z
&amp;version=1
&amp;zone=sh1
&amp;signature=bOQMI8wJ4ikFnadNXc%2BpnVMcUyf83C7b9JO5%2FAvkGyk%3D</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_示例代码">示例代码</h2>
<div class="sectionbody">
<div class="paragraph">
<p>示例代码以 golang、python 语言为例，其他语言类似。</p>
</div>
<div class="sect2">
<h3 id="_golang_示例">Golang 示例</h3>
<div class="paragraph">
<p><strong>构造验证请求串代码示例</strong></p>
</div>
<div class="paragraph">
<p>请用实际数据替换 <code>AccessKeyID</code>、<code>SecretAccessKey</code>、<code>Zone</code> 等信息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>package main

import (
	&#34;crypto/hmac&#34;
	&#34;crypto/sha256&#34;
	&#34;encoding/base64&#34;
	&#34;encoding/json&#34;
	&#34;fmt&#34;
	&#34;net/url&#34;
	&#34;sort&#34;
	&#34;strconv&#34;
	&#34;strings&#34;
	&#34;time&#34;
)

type verifyInfo struct {
	httpMothod      string
	path            string
	secretAccessKey string
	describeUsers   *describeUsers
}

type describeUsers struct {
	AccessKeyID      string `json:&#34;access_key_id&#34;`
	Action           string `json:&#34;action&#34;`
	SignatureMethod  string `json:&#34;signature_method&#34;`
	SignatureVersion int    `json:&#34;signature_version&#34;`
	Version          int    `json:&#34;version&#34;`
	Zone             string `json:&#34;zone&#34;`
	TimeStamp        string `json:&#34;time_stamp&#34;`
}

func hmacSha256(data string, secret string) []byte {
	h := hmac.New(sha256.New, []byte(secret))
	h.Write([]byte(data))
	return h.Sum(nil)
}

func formatParams(v interface{}) (map[string]interface{}, error) {
	paramMap := make(map[string]interface{})
	jsonBuf, err := json.Marshal(v)
	if err != nil {
		return nil, err
	}
	err = json.Unmarshal(jsonBuf, &amp;paramMap)
	if err != nil {
		return nil, err
	}
	return paramMap, nil
}

func sortParams(params map[string]interface{}) string {
	var keys []string
	for k := range params {
		keys = append(keys, k)
	}
	sort.Strings(keys)
	var parts []string
	for _, key := range keys {
		value := url.QueryEscape(strVal(params[key]))
		value = strings.Replace(strings.Replace(value, &#34;:&#34;, &#34;%3A&#34;, -1), &#34; &#34;, &#34;%20&#34;, -1)
		parts = append(parts, key+&#34;=&#34;+value)
	}
	return strings.Join(parts, &#34;&amp;&#34;)
}

func constructSignature(httpMothod, reqUrl, requestStr, key string) string {
	signaturePre := httpMothod + &#34;\n&#34; + reqUrl + &#34;\n&#34; + requestStr
	hmacShaStr := hmacSha256(signaturePre, key)
	base64Str := base64.StdEncoding.EncodeToString(hmacShaStr)
	signature := strings.TrimSpace(base64Str)
	signature = strings.Replace(signature, &#34; &#34;, &#34;+&#34;, -1)
	signature = url.QueryEscape(signature)
	return signature
}

func strVal(value interface{}) string {
	var key string
	if value == nil {
		return key
	}
	switch value.(type) {
	case int:
		it := value.(int)
		key = strconv.Itoa(it)
	case string:
		key = value.(string)
	default:
		newValue, _ := json.Marshal(value)
		key = string(newValue)
	}
	return key
}

func (v *verifyInfo) buildVerifyStr() (string, error) {
	params, err := formatParams(v.describeUsers)
	if err != nil {
		return &#34;&#34;, err
	}
	sortParams := sortParams(params)
	signature := constructSignature(v.httpMothod, v.path, sortParams, v.secretAccessKey)
	rsqParams := sortParams + &#34;&amp;signature=&#34; + signature
	return rsqParams, nil
}


func main() {
	vi := &amp;verifyInfo{
		httpMothod:      &#34;GET&#34;,
		path:            &#34;/iaas/&#34;,
		secretAccessKey: &#34;SECRETACCESSKEY&#34;,
		describeUsers: &amp;describeUsers{
			AccessKeyID:      &#34;QYACCESSKEYIDEXAMPLE&#34;,
			Action:           &#34;DescribeUsers&#34;,
			SignatureMethod:  &#34;HmacSHA256&#34;,
			SignatureVersion: 1,
			Version:          1,
			Zone:             &#34;sh1&#34;,
			TimeStamp:        time.Now().Format(&#34;2006-01-02T15:04:05Z&#34;),
		},
	}

	result, _ := vi.buildVerifyStr()
	fmt.Println(result)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>代码 result 结果即构造的验证请求串，由于验证信息有时效性，如中断数据发送后重新发送时间间隔大于 5 分钟，请重新构造验证请求串。</p>
</div>
<div class="paragraph">
<p><strong>验证所构造的验证请求串是否正确</strong></p>
</div>
<div class="paragraph">
<p>使用自己构造的验证请求串替换下面代码中 <code>result</code>，执行下面代码。打印结果为 1，验证请求串构造错误；打印结果为 0，验证请求串构造正确。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>type successRespJson struct {
	Message interface{} `json:&#34;message,required&#34;`
	RetCode int         `json:&#34;ret_code,required&#34;`
}

func Verify(url string) int {
	req, err := http.NewRequest(&#34;GET&#34;, url, nil)
	if err != nil {
		return 1
	}
	tr := &amp;http.Transport{
		TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true, Renegotiation: tls.RenegotiateOnceAsClient},
	}
	cli := http.Client{
		Transport:     tr,
		CheckRedirect: nil,
		Jar:           nil,
		Timeout:       0,
	}
	response, _:= cli.Do(req)
	defer response.Body.Close()
	body, _:= ioutil.ReadAll(response.Body)
	var vr successRespJson
	if response.StatusCode == http.StatusOK {
		if err := json.Unmarshal(body, &amp;vr); err != nil {
			return 1
		}
	}
	return vr.RetCode
}

func main() {
	result := &#34;access_key_id=CCDJRDKCCKZYTEXANZJD&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2020-12-23T14%3A03%3A44Z&amp;version=1&amp;zone=sh1&amp;signature=d6eMFDgO3E6wBqbbn2AydX%2BxQws7iD%2BtSgfGF6Lq7Uo%3D&#34;
	url := &#34;https://api.qingcloud.com/iaas/&#34; + &#34;?&#34; + result
	fmt.Println(Verify(url))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>上传自定义数据代码示例</strong></p>
</div>
<div class="paragraph">
<p>上传自定义数据需要预先在 CloudSat 自定义监控中创建命名空间和监控配置，并根据实际情况替换下面代码中一些数据，如 <code>UserId</code>、<code>Namespace</code>、<code>Region</code>、<code>Meter</code> 等。<code>Meter</code> 请与对应命名空间上监控配置中的监控指标保持一致。时间使用 <code>UTC 时间</code>，所有上传数据字段严格遵守接口数据规范中字段说明规范。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>package main

import (
	&#34;bytes&#34;
	&#34;encoding/json&#34;
	&#34;fmt&#34;
	&#34;math/rand&#34;
	&#34;net/http&#34;
	&#34;strconv&#34;
	&#34;time&#34;
)

type monitorData struct {
	UserId    string  `json:&#34;user_id&#34;`
	Namespace string  `json:&#34;namespace&#34;`
	Data      []meters `json:&#34;data&#34;`
}

type meters struct {
	Source       string `json:&#34;source&#34;`
	UserId       string `json:&#34;user_id&#34;`
	Tags         string `json:&#34;tags&#34;`
	GroupId      string `json:&#34;group_id&#34;`
	ResourceId   string `json:&#34;resource_id&#34;`
	ResourceName string `json:&#34;resource_name&#34;`
	ResourceType string `json:&#34;resource_type&#34;`
	RootUserId   string `json:&#34;root_user_id&#34;`
	Meter        string `json:&#34;meter&#34;`
	Region       string `json:&#34;region&#34;`
	Value        int    `json:&#34;value&#34;`
	ValueType    string `json:&#34;value_type&#34;`
	TimeStamp    string `json:&#34;time_stamp&#34;`
}

type date struct {
	UploadCount int `json:&#34;upload_count&#34;`
}

type ret struct {
	Data date `json:&#34;data&#34;`
	RetCode int `json:&#34;ret_code&#34;`
}

var client = http.Client{
	Timeout: 10 * time.Second,
}

func HttpPostJson(url string, data interface{}, result interface{}) error {
	buf := bytes.NewBuffer(nil)
	encoder := json.NewEncoder(buf)
	if err := encoder.Encode(data); err != nil {
		return err
	}

	request, err := http.NewRequest(http.MethodPost, url, buf)
	if err != nil {
		return err
	}

	request.Header.Add(&#34;Content-Type&#34;, &#34;application/json&#34;)
	request.Header.Add(&#34;Content-Type&#34;, &#34;charset=UTF-8&#34;)
	response, err := client.Do(request)
	if err != nil {
		return err
	}
	defer response.Body.Close()

	decoder := json.NewDecoder(response.Body)
	if err = decoder.Decode(&amp;result); err != nil {
		return err
	}
	fmt.Println(result)
	return nil
}

func main() {

    for {
	    timeStamp := time.Now().UTC().Format(&#34;2006-01-02T15:04:05Z&#34;)
		rand.Seed(time.Now().UnixNano())
		flag := strconv.Itoa(rand.Intn(16))
		p := monitorData{
			UserId: &#34;usr-12345678&#34;,
			Namespace: &#34;cloudsat-test&#34;,
			Data: []meters{
				{
					Source: &#34;dylan-test&#34;,
					UserId: &#34;usr-12345678&#34;,
					Tags: &#34;role=master,interface=eth10&#34;,
					GroupId: &#34;group1&#34;,
					ResourceId: &#34;i-instance-&#34;+flag ,
					ResourceName: &#34;name&#34;+flag,
					ResourceType: &#34;instance&#34;,
					RootUserId: &#34;usr-12345678&#34;,
					Meter: &#34;cpu&#34;,
					Region: &#34;sh1&#34;,
					Value: rand.Intn(100),
					ValueType: &#34;percent&#34;,
					TimeStamp:timeStamp,
				},{
					Source: &#34;dylan-test&#34;,
					UserId: &#34;usr-12345678&#34;,
					Tags: &#34;role=master,interface=eth10&#34;,
					GroupId: &#34;group1&#34; ,
					ResourceId: &#34;i-instance-&#34;+flag ,
					ResourceName: &#34;name&#34;+flag,
					ResourceType: &#34;instance&#34;,
					RootUserId: &#34;usr-12345678&#34;,
					Meter: &#34;memory&#34;,
					Region: &#34;sh1&#34;,
					Value: rand.Intn(100),
					ValueType: &#34;percent&#34;,
					TimeStamp:timeStamp,
				},
			},
		}
		var r ret

		url := `http://cloudsat.qingcloud.com/api/sh1/v1/custom/UploadMonitorData?access_key_id=CCDJRDKCCKZYTEXANZJD&amp;action=DescribeUsers&amp;signature_method=HmacSHA256&amp;signature_version=1&amp;time_stamp=2020-12-23T09%3A52%3A10Z&amp;version=1&amp;zone=sh1&amp;signature=vorfODyQzKD0v4En7y5mdwkvUe4OZGQcDdQU5xBSjio%3D`
		err := HttpPostJson(url,p,r)
		if err != nil {
			fmt.Println(err)
		}
		time.Sleep(time.Duration(1)*time.Second)
	}

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_python_完整上传自定义数据示例">python 完整上传自定义数据示例</h3>
<div class="paragraph">
<p>请根据实际，使用自己的 <code>access_key_id</code>、<code>secret_access_key</code>、<code>user_id</code>、<code>namespace</code>、<code>region</code>、<code>meter</code> 替换代码中相应变量，这里以<code>上海1区（sh1）</code>为例,实际应用中需要同步更新 <code>self.CloudSatUrl</code> 中对应的区间信息，详情参见上文。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>import hmac
import json
import base64
import datetime
import time
from hashlib import sha256
from collections import OrderedDict

try:
    import urllib.parse as urllib
except:
    import urllib
import requests

def sort_value(old_dict):
    items = sorted(old_dict.items())
    new_dict = OrderedDict()
    for item in items:
        new_dict[item[0]] = old_dict[item[0]]
    return new_dict

class UploadMonitorData(object):
    def __init__(self, access_key_id, secret_access_key):
        self.access_key_id = access_key_id
        self.secret_access_key = secret_access_key

        nowtime = datetime.datetime.now()
        self.signature_time = datetime.datetime.strftime(nowtime, &#34;%Y-%m-%dT%H:%M:%SZ&#34;)

        self.time_stamp = datetime.datetime.utcnow().strftime(&#34;%Y-%m-%dT%H:%M:%SZ&#34;)
        self.time = datetime.datetime.now().strftime(&#34;%Y-%m-%dT%H:%M:%SZ&#34;)
        self.url = &#34;https://api.qingcloud.com/iaas/&#34;
        self.CloudSatUrl = &#34;http://cloudsat.qingcloud.com/api/sh1/v1/custom/UploadMonitorData&#34;
        self.url_path = &#39;/iaas/&#39;
        self.methods = &#39;GET&#39;

    def post_request(self, post_url):
        headers = {&#34;Content-Type&#34;: &#34;application/json; charset=UTF-8&#34;}
        body = {
            &#34;user_id&#34;: &#34;usr-8Ljvov6I&#34;,
            &#34;namespace&#34;: &#34;pt-test&#34;,
            &#34;data&#34;: [
                {
                    &#34;source&#34;: &#34;custom&#34;,
                    &#34;user_id&#34;: &#34;usr-8Ljvov6I&#34;,
                    &#34;resource_id&#34;: &#34;i-ets7af6q&#34;,
                    &#34;resource_type&#34;: &#34;instance&#34;,
                    &#34;root_user_id&#34;: &#34;usr-8Ljvov6I&#34;,
                    &#34;meter&#34;: &#34;cpu&#34;,
                    &#34;region&#34;: &#34;sh1&#34;,
                    &#34;value&#34;: 99,
                    &#34;value_type&#34;: &#34;percent&#34;,
                    &#34;time_stamp&#34;: self.time_stamp
                }, {
                    &#34;source&#34;: &#34;custom&#34;,
                    &#34;user_id&#34;: &#34;usr-8Ljvov6I&#34;,
                    &#34;resource_id&#34;: &#34;i-ets7af6q&#34;,
                    &#34;resource_type&#34;: &#34;instance&#34;,
                    &#34;root_user_id&#34;: &#34;usr-8Ljvov6I&#34;,
                    &#34;meter&#34;: &#34;memory&#34;,
                    &#34;region&#34;: &#34;sh1&#34;,
                    &#34;value&#34;: 96,
                    &#34;value_type&#34;: &#34;percent&#34;,
                    &#34;time_stamp&#34;: self.time_stamp
                }
            ]
        }
        result = requests.post(url=post_url, headers=headers, data=json.dumps(body))
        print(result.status_code)
        print(result.reason)
        print(result.text)

    def post_monitor_data(self):
        od = OrderedDict()
        od[&#39;access_key_id&#39;] = self.access_key_id
        od[&#39;action&#39;] = &#34;DescribeUsers&#34;
        od[&#39;signature_method&#39;] = &#34;HmacSHA256&#34;
        od[&#39;signature_version&#39;] = 1
        od[&#39;time_stamp&#39;] = self.signature_time
        od[&#39;version&#39;] = 1
        od[&#39;zone&#39;] = &#34;sh1&#34;

        od_sort = sort_value(od)
        data = urllib.urlencode(od_sort)
        string_to_sign = self.methods + &#34;\n&#34; + self.url_path + &#34;\n&#34; + data
        print(string_to_sign)
        h = hmac.new(self.secret_access_key.encode(), digestmod=sha256)
        h.update(string_to_sign.encode())
        sign = base64.b64encode(h.digest()).strip()
        signature = urllib.quote_plus(sign)
        post_url = self.CloudSatUrl + &#34;?&#34; + data + &#34;&amp;signature=&#34; + signature
        self.post_request(post_url)

if __name__ == &#39;__main__&#39;:
    access_key_id = &#39;ACCESSKEYID&#39;
    secret_access_key = &#39;SECRETACCESSKEY&#39;

    while True:
        upload_struct_object = UploadMonitorData(access_key_id, secret_access_key)
        upload_struct_object.post_monitor_data()
        time.sleep(3)</code></pre>
</div>
</div>
</div>
</div>
</div>

    

  </div>
  <div class="post-footer">
    <div class="post-prev">
    </div>
    <div class="post-next">
    </div>
  </div>
  <div class="post-back-to-top">
    <span class="icon-up_3_fill"></span>
  </div>
</div>
<div class="post-placeholder"><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_uploadmonitordata_接口_url_构造规范">UploadMonitorData 接口 URL 构造规范</a></li>
    <li><a href="#_uploadmonitordata_接口数据规范">UploadMonitorData 接口数据规范</a></li>
    <li><a href="#_构造请求串方法">构造请求串方法</a>
      <ul>
        <li><a href="#_步骤_1参数升序排列">步骤 1：参数升序排列</a></li>
        <li><a href="#_步骤_2参数_url_编码">步骤 2：参数 URL 编码</a></li>
        <li><a href="#_步骤_3构造_url_请求">步骤 3：构造 URL 请求</a></li>
        <li><a href="#_步骤_4构造被签名串">步骤 4：构造被签名串</a></li>
        <li><a href="#_步骤_5计算签名">步骤 5：计算签名</a></li>
        <li><a href="#_步骤_6添加签名">步骤 6：添加签名</a></li>
      </ul>
    </li>
    <li><a href="#_示例代码">示例代码</a>
      <ul>
        <li><a href="#_golang_示例">Golang 示例</a></li>
        <li><a href="#_python_完整上传自定义数据示例">python 完整上传自定义数据示例</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div></div>
      </div>
    </div>
  </div>
</div></div>
    </body><script src="/js/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/search/jquery.mark.min.js"></script>

<script type="text/javascript" src="/js/common.428b8a7f426567136e0501d49705f10dac2e4539d10c2f396d7c9ee45df1469eaa38e983928589e0e35ed30c1732ddbcda694ac0928ffffffee76b4a0017adf2.js" integrity="sha512-QouKf0JlZxNuBQHUlwXxDawuRTnRDC85bXye5F3xRp6qOOmDkoWJ4ONe0wwXMt282mlKwJKP///&#43;52tKABet8g=="></script>

<script type="text/javascript" src="/js/search.d8001c3e1b66b9a0b48e0c23ad0dbfc0906f194f8925ae78a9900b960679cfa7e41cebd9efd654f84535d02cbce7c4971f226e6f07288c26c3c4560c36d7655b.js"></script>
<script>
  $(function() {
    
    hljs.highlightAll();
    
    $.each($('.post-content .imageblock img'), function () {
      $(this).attr('data-mfp-src', $(this).attr('src'));
    });
    $('.post-content').magnificPopup({
      disableOn: function () {
        if ($(window).width() < 600) {
          return false;
        }
        return true;
      },
      delegate: '.imageblock img',
      type: 'image',
      gallery: {
        enabled: true,
      },
    });
  });
</script>
</html>
