




<!DOCTYPE html>
<html lang="zh"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<meta name="keywords" content="[QKE, 工作负载,服务,负载均衡器]">



<meta name="description" content="介绍如何管理已创建的服务。">

<link rel="icon" href="https://console.petaexpress.com/assets/cdn/hinata/0a234310-78f9-4323-8d59-2b36ac15120a-favicon.ico" type="image/x-icon">

<title>配置负载均衡器 - 用户指南</title>
<link href="/css/bulma.css" rel="stylesheet">
<link href="/css/bulma-tooltip.min.css" rel="stylesheet">
<link href="/css/atom-one-light.css" rel="stylesheet" />
<link href="/css/magnific-popup.css" rel="stylesheet" />


<link href="/scss/main.min.e407fb236ca21333e8c63516ab2f144dd2cdbdaf2eca08e58895ff89ce74abc3.css" rel="stylesheet" integrity="sha256-5Af7I2yiEzPoxjUWqy8UTdLNva8uygjliJX/ic50q8M=">

<script src="/js/jquery-2.2.4.js"></script>
<body
        class="root   "
        style=""
        ><header>
  <nav class="navbar">
    
      <a href="/" class="navbar-logo-wrapper">
        <img class="navbar-logo" src="https://console.petaexpress.com/assets/cdn/hinata/ba65c1e6-b7a4-4085-b0e2-23104d8e71e1-logo_en.svg" />
        <div class="navbar-split navbar-left-split">|</div>
        <div class="navbar-logo-text">企业云</div>
      </a>
    
    <div class="navbar-nav">
      <div
        class="navbar-nav-item navbar-nav-version "
        style="display:none;">
        
        <div class="dropdown-trigger">
          <span class="project-version">
            v6.1
          </span>
          
        </div>
        
      </div>
      
    </div>
    <div class="search navbar-search">
      <form action="/v6.1/search/" method="GET">
        <div class="control has-icons-left has-icons-right docs-search-input">
          <span class="icon is-left">
            <img src="/images/icons/magnifier_duotone.svg" />
          </span>
          <input
            class="input"
            name="q"
            type="input"
            placeholder="请输入关键字快速获取帮助"
            autocomplete="off"
          />
          <span class="icon is-right"> </span>
        </div>
        <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
      </form>
      <div class="search-result navbar-search-result">
        <div class="search-result-loading"></div>
        <div class="search-result-content"></div>
        <div class="search-result-none">
          没有找到搜索结果， 请更换关键词重新搜索
        </div>
      </div>
    </div>
    
      
      
        
          <a class="navbar-item-right btn primary-btn navbar-btn "
            target="_blank"
            data-url="https://console.petaexpress.com"
            data-text="控制台"
            href="https://console.petaexpress.com">
            控制台
          </a>
        
      
    
  </nav>
</header><script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>

<script id="search-result-item-template" type="text/x-js-template">
  <div class="search-result-content-item">
    <div class="search-result-content-item-title">
      <a href="${href}">${title}</a>
    </div>
    <div class="search-result-content-item-content">
      ${content}
    </div>
    <div class="search-result-content-item-ref">
      <ul class="content-breadcrumb">
      </ul>
    </div>
  </div>
</div>
</script>

<script id="search-breadcrumb-template" type="text/x-js-template">
  <li class="icon-slash_fill">
    <a href="${href}">${title}</a>
  </li>
</script>

<script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>
<script id="search-result-page-template" type="text/x-js-template">
  <nav class="search-result-pagination pagination is-centered">
    <a class="pagination-previous icon-chevron_left_fill"></a>
    <a class="pagination-next icon-chevron_right_fill"></a>
    <ul class="pagination-list">
    </ul>
  </nav>
</script>
<div class="container">

  


  
    
  


<aside class="sidebar-wrapper">
  <div class="sidebar-drag"></div>
  <div class="sidebar">
    
      <div class="sidebar-title" >
        <a href="/v6.1/container/qke_plus/">
          
            容器引擎 QKE
        </a>
        
          <span class="icon-menu_fill"></span>
        
      </div>
      
        <div class="search-sidebar-wrapper">
          
<div class="search search-sidebar">
  <div class="control has-icons-left has-icons-right docs-search-input">
    <span class="icon is-left">
      <img src="/images/icons/magnifier_duotone.svg" />
    </span>
    <input class="input" name="q" type="input" placeholder="请输入关键字快速获取帮助" autocomplete="off" />
    <span class="icon is-right"> </span>
  </div>
  <img class="clear-search-input" src="/images/icons/close_duotone.svg" />
</div>
<div class="search-sidebar-result columns">
  
    <div class="column">
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-computing_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">计算</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/compute/vm/">
      云服务器
    </a>
    
    <a href="/v6.1/compute/hpc/">
      弹性高性能计算 EHPC
    </a>
    
    <a href="/v6.1/compute/image/">
      镜像
    </a>
    
    <a href="/v6.1/compute/ssh/">
      SSH 密钥
    </a>
    
    <a href="/v6.1/compute/instance_group/">
      安置策略组
    </a>
    
    <a href="/v6.1/compute/migration/">
      跨区域迁移
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-database_cache_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据库</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/database/mysql/">
      关系型数据库 MySQL Plus
    </a>
    
    <a href="/v6.1/database/postgresql/">
      关系型数据库 PostgreSQL
    </a>
    
    <a href="/v6.1/database/radondb/">
      分布式数据库 RadonDB
    </a>
    
    <a href="/v6.1/database/polondb/">
      分布式数据库 PolonDB
    </a>
    
    <a href="/v6.1/database/chronusdb/">
      时序数据库 ChronusDB
    </a>
    
    <a href="/v6.1/database/mongodb/">
      文档数据库 MongoDB
    </a>
    
    <a href="/v6.1/database/mongodb_cluster/">
      文档数据库 MongoDB Cluster
    </a>
    
    <a href="/v6.1/database/redis_standalone/">
      键值数据库 Redis Standalone
    </a>
    
    <a href="/v6.1/database/redis_cluster/">
      键值数据库 Redis Cluster
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-container_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">容器</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/container/qke_plus/">
      容器引擎 QKE
    </a>
    
    <a href="/v6.1/container/harbor/">
      Harbor 镜像仓库
    </a>
    
  </div>
</div>
        
      
        
      
        
      
        
      
        
          <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-operation_manage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">运维与管理</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/operation/migration/">
      服务器迁移中心
    </a>
    
    <a href="/v6.1/operation/topology/">
      资源编排
    </a>
    
    <a href="/v6.1/operation/resource/">
      资源管理
    </a>
    
    <a href="/v6.1/operation/autoscaling/">
      自动伸缩
    </a>
    
    <a href="/v6.1/operation/tools/">
      运维工具
    </a>
    
    <a href="/v6.1/operation/vmware/">
      VMware 纳管
    </a>
    
  </div>
</div>
        
      
        
      
    </div>
    <div class="column">
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-storage_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">存储</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/storage/disk/">
      硬盘
    </a>
    
    <a href="/v6.1/storage/backup/">
      备份
    </a>
    
    <a href="/v6.1/storage/object_storage/">
      对象存储
    </a>
    
    <a href="/v6.1/storage/epfs/">
      文件存储 EPFS
    </a>
    
    <a href="/v6.1/storage/vnas/">
      文件存储 vNAS
    </a>
    
    <a href="/v6.1/storage/qfs/">
      文件存储 QFS
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-mq_middleware_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">消息队列与中间件</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/middware/kafka/">
      Kafka 服务
    </a>
    
    <a href="/v6.1/middware/rabbitmq/">
      RabbitMQ 服务
    </a>
    
    <a href="/v6.1/middware/etcd/">
      Etcd 服务
    </a>
    
    <a href="/v6.1/middware/api_gateway/">
      API 网关
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-shield_key_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">安全</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/security/firewall/">
      云防火墙 CFW
    </a>
    
    <a href="/v6.1/security/srp/">
      安全资源池
    </a>
    
    <a href="/v6.1/security/hss/">
      主机安全
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-data_warehouse_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">用户服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/services/bill_center/">
      费用中心
    </a>
    
    <a href="/v6.1/services/notification-center/">
      消息中心
    </a>
    
    <a href="/v6.1/services/vdc/">
      企业管理
    </a>
    
  </div>
</div>
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-nat_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">网络服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/network/vpc/">
      VPC 网络
    </a>
    
    <a href="/v6.1/network/nat_gateway/">
      NAT 网关
    </a>
    
    <a href="/v6.1/network/eip/">
      弹性公网 EIP
    </a>
    
    <a href="/v6.1/network/loadbalancer/">
      负载均衡
    </a>
    
    <a href="/v6.1/network/border_router/">
      边界路由器
    </a>
    
    <a href="/v6.1/network/security_group/">
      安全组
    </a>
    
    <a href="/v6.1/network/acl/">
      网络访问控制
    </a>
    
    <a href="/v6.1/network/mcn/">
      流量牵引服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bigdata_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">大数据服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/bigdata/elk/">
      ELK 服务
    </a>
    
    <a href="/v6.1/bigdata/opensearch/">
      OpenSearch 服务
    </a>
    
    <a href="/v6.1/bigdata/zookeeper/">
      ZooKeeper 服务
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-monitor_service_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">监控服务</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/monitor_service/cloudsat/">
      云监控 CloudSat
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
    </div>
    <div class="column">
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-apps_5_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">AppCenter</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/appcenter/market/">
      AppCenter 控制台
    </a>
    
    <a href="/v6.1/appcenter/dev-platform/">
      应用开发平台
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-bi_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">数据仓库与 BI</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/dwh_bi/clickhouse/">
      ClickHouse
    </a>
    
  </div>
</div>
      
      
      
      
      
      
      
      
      
      <div class="search-sidebar-result-item">
  <div class="search-sidebar-result-item-title">
    
    <span class="search-sidebar-result-item-title-icon content-item-title-icon icon-human_gear_duotone">
      <span class="path1"></span>
      <span class="path2"></span>
      <span class="path3"></span>
      <span class="path4"></span>
      <span class="path5"></span>
      <span class="path6"></span>
      <span class="path7"></span>
      <span class="path8"></span>
      <span class="path9"></span>
      <span class="path10"></span>
      <span class="path11"></span>
      <span class="path12"></span>
      <span class="path13"></span>
      <span class="path14"></span>
      <span class="path15"></span>
    </span>
    
    <span class="search-sidebar-result-item-title-text">访问与鉴权</span>
  </div>
  <div class="search-sidebar-result-item-children">
    
    <a href="/v6.1/authorization/iam/">
      访问鉴权管理
    </a>
    
    <a href="/v6.1/authorization/account/">
      账户中心
    </a>
    
    <a href="/v6.1/authorization/access_key/">
      API 密钥
    </a>
    
  </div>
</div>
      
      
      
      
      
      
    </div>
  
</div>
        </div>
      
    
    <nav class="sidebar-menu">
      
        
        <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >产品简介</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/introduction/">什么是 QKE</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/advantage/">产品优势</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/aply_scenarios/">应用场景</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/function/">产品功能</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/component/">组件版本</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/plugin/">插件支持</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/limitation/">限制说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/term/">基本概念</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/intro/term_to_k8s/">原生 Kubernetes 名词对照</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >计费指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/billing/bill_des/">计费说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/billing/bill_change/">费用变更</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/billing/due_owe/">到期与欠费</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >快速入门</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/quickstart/create_selfmgt_cluster/">创建 QKE 自管版集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/quickstart/cfg_mirror_repo/">配置镜像仓库</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/quickstart/create_app/">创建工作负载</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a >操作指南</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >集群连接</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/connect/kubectl_cnect/">使用 kubectl 连接集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/connect/ssh_login_cluster/">通过 SSH 登录自管版集群节点</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >集群管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_cluster/cluster_overview/">查看集群概览</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_cluster/cluster_info/">查看集群信息</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_cluster/paras_cfg/">配置集群参数</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_cluster/change_cluster_scale/">集群扩缩容</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_cluster/start_stop_cluster/">启停集群</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_cluster/delete_cluster/">删除集群</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >节点管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_node/node_intro/">节点概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_node/node_reserve/">节点资源预留</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_node/node_amount/">调整节点数量</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_node/auto_node/">节点弹性伸缩</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_node/node_cfg/">更改节点配置</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mgt_node/restart_node/">重启节点</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >挂载资源</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mounting_resource/resource_des/">挂载资源说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/mounting_resource/view_resource/">查看挂载资源</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a >服务</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/service/introduction/">服务概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/service/view_service/">查看服务</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/service/lb_service/">将服务暴露给外网</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item active current">
            <a href="/v6.1/container/qke_plus/manual/service/ccm_config/">配置负载均衡器</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >工作负载</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/work_load/introduction/">工作负载概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/work_load/mgt_workload/">管理工作负载</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >可视化控制台</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/console/console_intro/">概述</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/console/install_ks/">安装可视化控制台</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/console/bind_eip/">修改控制台访问方式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/console/access_ks/">登录控制台</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/console/install_component/">安装控制台组件</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/console/upgrade_ks/">升级 KubeSphere</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >集群运维</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/om_mgt/log/">查看集群日志</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >监控管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/om_mgt/monitor/index_desc/">监控指标说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/om_mgt/monitor/view_data/">查看监控数据</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >告警管理</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/om_mgt/alarm/alarm_index/">告警指标说明</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/om_mgt/alarm/cfg_alarm/">配置告警策略</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/om_mgt/upgrade_cluster/">升级集群</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >费用相关</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/bill_operation/billing_detail/">查看计费详情</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/bill_operation/change_billing_mode/">修改计费模式</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/bill_operation/apply_renewal/">手动续费</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/manual/bill_operation/auto_renewal/">自动续费</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >最佳实践</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/best-practice/how_use_ks/">在 QKE 中使用 KubeSphere</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/best-practice/qke_vnas/">在 QKE 中使用文件存储 vNAS</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >常见问题</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/faq/cluster_faq/">集群管理 FAQ</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/faq/node_faq/">节点管理 FAQ</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/faq/container_faq/">容器应用 FAQ</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a >存储 FAQ</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/faq/storage_faq/k8s_pv_pvc_storageclass/">如何理解 Kubernetes 持久化存储体系</a>
          </li>
        
      
    
  
    
      
      
      
      
          
          <li class="sidebar-item  ">
            <a href="/v6.1/container/qke_plus/faq/storage_faq/workload_storage/">云服务器类型与存储类型</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
</ul>
      
    </nav>

  </div>
</aside>
<div class="content-card-wrapper">
  <div class="content-card">
    <div class="content-wrapper"><ul class="content-breadcrumb">
      <li class="icon-slash_fill"><a href="/v6.1" data-url="/v6.1">用户指南</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/container/qke_plus" data-url="/v6.1/container/qke_plus">容器引擎 QKE</a></li>
        
        <li class="icon-slash_fill"><a href="/v6.1/container/qke_plus/manual/connect/kubectl_cnect/" data-url="/v6.1/container/qke_plus/manual">操作指南</a></li>
        
        <li class="icon-slash_fill"><a href="/v6.1/container/qke_plus/manual/service/introduction/" data-url="/v6.1/container/qke_plus/manual/service">服务</a></li>
      <li class="icon-slash_fill"><a href="/v6.1/container/qke_plus/manual/service/ccm_config" data-url="/v6.1/container/qke_plus/manual/service/ccm_config">配置负载均衡器</a></li></ul><div class="post-wrapper"><div class="post">
  <h1 class="post-title">
    配置负载均衡器</h1>
  <div class="post-info">
    <div class="post-date">
      更新时间：2024-03-07 19:06:53
    </div>
    
    
    
    
    
    
    
      <div
        class="tag post-tag export-pdf has-tooltip-top has-tooltip-arrow"
        data-tooltip="下载范围：所属一级目录的全部内容"
        data-url="/v6.1/container/qke_plus/manual">
        <span class="icon-format_pdf_2_fill"></span>
        PDF
      </div>
      
    
  </div><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_背景信息">背景信息</a></li>
    <li><a href="#_约束与限制">约束与限制</a></li>
    <li><a href="#_配置负载均衡器属性">配置负载均衡器属性</a></li>
    <li><a href="#_配置负载均衡器公网_ip">配置负载均衡器公网 IP</a>
      <ul>
        <li><a href="#_手动配置公网_ip">手动配置公网 IP</a></li>
        <li><a href="#_自动获取公网_ip">自动获取公网 IP</a></li>
      </ul>
    </li>
    <li><a href="#_配置使用云上现有的负载均衡器">配置使用云上现有的负载均衡器</a></li>
    <li><a href="#_配置监听器属性">配置监听器属性</a></li>
    <li><a href="#_配置内网负载均衡器">配置内网负载均衡器</a></li>
  </ul>
</nav>
</div><div class="post-content">
    
      
      
<div class="paragraph">
<p>本文主要介绍需要对接负载均衡器插件时，如何通过配置服务的注解（Annotation）来实现服务的一些高级配置功能。</p>
</div>
<div class="sect1">
<h2 id="_背景信息">背景信息</h2>
<div class="sectionbody">
<div class="paragraph">
<p>进行配置操作前，您需要了解以下背景知识：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>关于服务注解（Annotation）：</p>
<div class="paragraph">
<p>服务的注解记录了关于当前服务的额外配置，使用 key/value 键值对的形式进行定义。详细介绍及使用说明请参见 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/working-with-objects/annotations/">Kubernetes 官方文档</a>。</p>
</div>
</li>
<li>
<p>关于负载均衡器插件（cloud-controller-manager）：</p>
<div class="paragraph">
<p><a href="https://github.com/yunify/qingcloud-cloud-controller-manager">cloud-controller-manager</a> 是云平台负载均衡器插件，自动集成于 QKE 中。支持将 Kubernetes 内部服务和负载均衡器关联起来，可自动创建负载均衡器、公网 IP，通过负载均衡器将服务暴露给集群外部调用。</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_约束与限制">约束与限制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>除本文介绍的相关配置外，更多的功能支持，如<strong>转发规则定义</strong>、<strong>透明代理</strong>等功能还在开发中，目前暂不支持。建议您可以在负载均衡器控制台进行负载均衡器的更多更全面的配置。</p>
</div>
<table class="tableblock frame-all grid-all stretch admon attention">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>请勿随意修改集群内部系统自动创建的负载均衡器配置，尤其是 K8s apiserver 使用的负载均衡监听器（监听协议/端口为 TCP/6443），若修改将导致 K8s apiserver 不可用。</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_配置负载均衡器属性">配置负载均衡器属性</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>配置方法</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过在 Service 的 <code>annotations</code> 中添加 <code>ServiceAnnotationLoadBalancerType</code> 来配置负载均衡器的规格。不添加此 key 的 Service 在 Event 中会有错误。其值范围 <strong>CreateLoadBalancer</strong> 接口中的 <code>loadbalancer_typ</code> 取值范围相同。</p>
</li>
<li>
<p>负载均衡器支持 http/https 协议的负载均衡，如果想要使用负载均衡器的七层能力，请将服务的特定的端口 <code>name</code> 指定为 <code>http</code> 或 <code>https</code>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>配置示例</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Service
apiVersion: v1
metadata:
  name:  mylbapp
  annotations:
    service.beta.kubernetes.io/qingcloud-load-balancer-type: &#34;0&#34;  #这里指定负载均衡器实例的规格
spec:
  selector:
    app:  mylbapp
  type:  LoadBalancer
  ports:
  - name:  http   #这里指定 port name,如果有多个http端口，都可以指定为http
    port:  8088
    targetPort:  80</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置负载均衡器公网_ip">配置负载均衡器公网 IP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用负载均衡器时需要配置一个公网 IP，cloud-controller 带有 IP 管理功能。</p>
</div>
<div class="sect2">
<h3 id="_手动配置公网_ip">手动配置公网 IP</h3>
<div class="paragraph">
<p><strong>配置方法</strong></p>
</div>
<div class="paragraph">
<p>这是本插件的默认方式，即用户需要在 Service 中添加公网 IP 的 Annotation。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>首先在 Service Annotation 中添加 Key： <code>service.beta.kubernetes.io/qingcloud-load-balancer-eip-source</code>，并设置其值为 <code>mannual</code>。如果不设置此 Key，则默认是 <code>mannual</code>。</p>
</li>
<li>
<p>然后必须继续添加 Key： <code>service.beta.kubernetes.io/qingcloud-load-balancer-eip-ids</code>，其值公网 IP 的 ID，如果需要绑定多个 IP，以逗号分隔。请确保公网 IP 处于<code>可用</code>状态。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>配置示例</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Service
apiVersion: v1
metadata:
  name:  mylbapp
  annotations:
    service.beta.kubernetes.io/qingcloud-load-balancer-eip-ids: &#34;eip-xxxxx&#34;  #这里指定公网IP的ID
    service.beta.kubernetes.io/qingcloud-load-balancer-type: &#34;0&#34;
spec:
  selector:
    app:  mylbapp
  type:  LoadBalancer
  ports:
  - name:  http
    port:  8088
    targetPort:  80</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_自动获取公网_ip">自动获取公网 IP</h3>
<div class="paragraph">
<p><strong>自动获取方式</strong></p>
</div>
<div class="paragraph">
<p>自动获取 IP 有三种方式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>自动获取当前账户下处于可用的公网 IP，如果找不到返回错误。</p>
</li>
<li>
<p>自动获取当前账户下处于可用的公网 IP，如果找不到则申请一个新的。</p>
</li>
<li>
<p>不管账户下有没有可用的公网 IP，申请一个新公网 IP。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>配置方法</strong></p>
</div>
<div class="paragraph">
<p>开启公网 IP 自动获取的功能，需进行如下操作：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在集群的配置文件中 <code>/etc/kubernetes/qingcloud.conf</code> 配置 <code>userID</code>。因为一些用户 API 权限较大，会获取到其他用户的 IP。</p>
</li>
<li>
<p>配置 Service Annotations 中的 <code>service.beta.kubernetes.io/qingcloud-load-balancer-eip-source</code> 不为 <code>mannual</code>，上述三种获取方式对应的值分别为：</p>
<div class="ulist">
<ul>
<li>
<p><code>use-available</code></p>
</li>
<li>
<p><code>auto</code></p>
</li>
<li>
<p><code>allocate</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>配置示例</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Service
apiVersion: v1
metadata:
  name:  mylbapp
  annotations:
    service.beta.kubernetes.io/qingcloud-load-balancer-eip-source: &#34;auto&#34; # 指定自动获取方式，可填填 auto、use-available 或 allocate
    service.beta.kubernetes.io/qingcloud-load-balancer-type: &#34;0&#34;
spec:
  selector:
    app:  mylbapp
  type:  LoadBalancer
  ports:
  - name:  http
    port:  8088
    targetPort:  80</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置使用云上现有的负载均衡器">配置使用云上现有的负载均衡器</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>注意事项</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>在此模式下，负载均衡器的一些功能属性，包括七层协议、规格、公网 IP 都由用户配置，负载均衡器插件不会修改任何属性，除了增删一些监听器。</p>
</li>
<li>
<p>请确保负载均衡器处于正常工作状态，并且和 Service 对应的端口不冲突，即已有监听器的监听端口不能和需要暴露的服务冲突。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>配置方法</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>添加 key <code>service.beta.kubernetes.io/qingcloud-load-balancer-eip-strategy</code> ，设置期值为 <code>reuse-lb</code>。</p>
</li>
<li>
<p>添加 key <code>service.beta.kubernetes.io/qingcloud-load-balancer-id</code>，设置其值为现有的负载均衡器 ID，类似&#34;lb-xxxxxx&#34;。</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>其余设置都会被负载均衡器插件忽略。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>配置示例</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Service
apiVersion: v1
metadata:
  name:  reuse-lb
  annotations:
    service.beta.kubernetes.io/qingcloud-load-balancer-eip-strategy: &#34;reuse-lb&#34;
    service.beta.kubernetes.io/qingcloud-load-balancer-id: &#34;lb-oglqftju&#34;
spec:
  selector:
    app:  mylbapp
  type:  LoadBalancer
  ports:
  - name:  http
    port:  8090
    targetPort:  80</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置监听器属性">配置监听器属性</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>配置方法</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>设置监听器的健康检查方式：添加 key <code>service.beta.kubernetes.io/qingcloud-lb-listener-healthycheckmethod</code>，设置其值为“监听端口:检查方式”。对于 TCP 协议监听器，检查方式默认为 <code>TCP</code>，对于 UDP 协议监听器，检查方式默认为<code>UDP</code>。</p>
</li>
<li>
<p>设置监听器的健康检查参数：添加 key <code>service.beta.kubernetes.io/qingcloud-lb-listener-healthycheckoption</code>，设置其值为“监听端口:检查参数”，检查参数默认值为 <code>10|5|2|5</code>，分别对应“检查间隔｜超时时间｜不健康阈值｜健康阈值”。</p>
</li>
<li>
<p>设置负载均衡方式：添加 key <code>service.beta.kubernetes.io/qingcloud-lb-listener-balancemode</code>，支持 roundrobin（轮询）、leastconn（最少连接）、source（源地址） 三种负载均衡方式，默认为 <code>roundrobin</code>。</p>
</li>
<li>
<p>配置 HTTPS 协议及证书，添加 key <code>service.beta.kubernetes.io/qingcloud-lb-listener-cert</code>，设置其值为“监听端口:证书ID”。如果配置了证书，则监听器使用 https 协议，没有此注解则默认使用 Service 所用协议。</p>
</li>
<li>
<p>配置多个监听器时，通过逗号分隔，区分不同监听器：<code>80:xxx,443:xxx</code>。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch admon note">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>监听器参数说明，请参考监听器 API 接口文档。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>配置示例</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
metadata:
  name:  reuse-lb
  annotations:
    service.beta.kubernetes.io/qingcloud-load-balancer-eip-strategy: &#34;reuse-lb&#34;
    service.beta.kubernetes.io/qingcloud-load-balancer-id: &#34;lb-oglqftju&#34;
    service.beta.kubernetes.io/qingcloud-lb-listener-healthycheckmethod: &#34;8090:tcp&#34;
    service.beta.kubernetes.io/qingcloud-lb-listener-healthycheckoption: &#34;8090:10|5|2|5&#34;
    service.beta.kubernetes.io/qingcloud-lb-listener-balancemode: &#34;8090:source&#34;
    service.beta.kubernetes.io/qingcloud-lb-listener-cert: &#34;8090:sc-77oko7zj&#34;
spec:
  selector:
    app:  mylbapp
  type:  LoadBalancer
  ports:
  - name:  http
    port:  8090
    protocol: TCP
    targetPort:  80</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配置内网负载均衡器">配置内网负载均衡器</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>已知问题</strong></p>
</div>
<div class="paragraph">
<p>Kubernetes 在 ipvs 模式下，kube-proxy 会把内网负载均衡器的 IP 绑定在 ipvs 接口上，这样会导致从负载均衡器过来的包被 drop（进来的是主网卡，但是出去的时候发现 ipvs 有这么一个 IP，路由不一致），故目前无法在 ipvs 模式下使用内网负载均衡器。详情参考 <a href="https://github.com/kubernetes/kubernetes/issues/79783">issue</a>。</p>
</div>
<div class="paragraph">
<p><strong>配置方法</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>必须手动指定 <code>service.beta.kubernetes.io/qingcloud-load-balancer-network-type</code> 为 <code>internal</code>，如果不指定或者填写其他值，则默认为公网负载均衡器，需要配置公网 IP。</p>
</li>
<li>
<p>可指定负载均衡器所在的私有网络，默认为创建 LB 插件配置文件中的 <code>defaultVxnet</code>，手动配置私有网络，需要添加此 Annotation： <code>service.beta.kubernetes.io/qingcloud-load-balancer-vxnet-id:{vxnet-id}</code></p>
</li>
<li>
<p>可指定负载均衡器内网 IP，通过添加 key <code>service.beta.kubernetes.io/qingcloud-load-balancer-internal-ip</code> 指定。</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch admon attention">
<colgroup>
<col style="width: 100%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">注意</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>当前不支持更换内网 IP。</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>配置示例</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Service
apiVersion: v1
metadata:
  name:  mylbapp
  namespace: default
  annotations:
    service.beta.kubernetes.io/qingcloud-load-balancer-type: &#34;0&#34;
    service.beta.kubernetes.io/qingcloud-load-balancer-network-type: &#34;internal&#34;
    service.beta.kubernetes.io/qingcloud-load-balancer-internal-ip: &#34;192.168.0.1&#34; ##如果要路由器自动分配删掉这一行
spec:
  selector:
    app:  mylbapp
  type:  LoadBalancer
  ports:
  - name:  http
    port:  80
    targetPort:  80</code></pre>
</div>
</div>
</div>
</div>

    

  </div>
  <div class="post-footer">
    <div class="post-prev">
    </div>
    <div class="post-next">
    </div>
  </div>
  <div class="post-back-to-top">
    <span class="icon-up_3_fill"></span>
  </div>
</div>
<div class="post-placeholder"><div class="post-menu">
  <div class="post-menu-title">本页目录</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_背景信息">背景信息</a></li>
    <li><a href="#_约束与限制">约束与限制</a></li>
    <li><a href="#_配置负载均衡器属性">配置负载均衡器属性</a></li>
    <li><a href="#_配置负载均衡器公网_ip">配置负载均衡器公网 IP</a>
      <ul>
        <li><a href="#_手动配置公网_ip">手动配置公网 IP</a></li>
        <li><a href="#_自动获取公网_ip">自动获取公网 IP</a></li>
      </ul>
    </li>
    <li><a href="#_配置使用云上现有的负载均衡器">配置使用云上现有的负载均衡器</a></li>
    <li><a href="#_配置监听器属性">配置监听器属性</a></li>
    <li><a href="#_配置内网负载均衡器">配置内网负载均衡器</a></li>
  </ul>
</nav>
</div></div>
      </div>
    </div>
  </div>
</div></div>
    </body><script src="/js/bootstrap.min.js"></script>
<script src="/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/js/copy-to-clipboard.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/js/jquery.tmpl.min.js"></script>
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/search/jquery.mark.min.js"></script>

<script type="text/javascript" src="/js/common.428b8a7f426567136e0501d49705f10dac2e4539d10c2f396d7c9ee45df1469eaa38e983928589e0e35ed30c1732ddbcda694ac0928ffffffee76b4a0017adf2.js" integrity="sha512-QouKf0JlZxNuBQHUlwXxDawuRTnRDC85bXye5F3xRp6qOOmDkoWJ4ONe0wwXMt282mlKwJKP///&#43;52tKABet8g=="></script>

<script type="text/javascript" src="/js/search.d8001c3e1b66b9a0b48e0c23ad0dbfc0906f194f8925ae78a9900b960679cfa7e41cebd9efd654f84535d02cbce7c4971f226e6f07288c26c3c4560c36d7655b.js"></script>
<script>
  $(function() {
    
    hljs.highlightAll();
    
    $.each($('.post-content .imageblock img'), function () {
      $(this).attr('data-mfp-src', $(this).attr('src'));
    });
    $('.post-content').magnificPopup({
      disableOn: function () {
        if ($(window).width() < 600) {
          return false;
        }
        return true;
      },
      delegate: '.imageblock img',
      type: 'image',
      gallery: {
        enabled: true,
      },
    });
  });
</script>
</html>
